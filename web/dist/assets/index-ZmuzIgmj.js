const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BZAmtwIl.js","assets/semi-ui-BLcMfhPi.js","assets/react-core-D0qmaBEd.js","assets/semi-ui-DXG8HP4s.css","assets/tools-CIWJskKV.js","assets/react-components-BQX6XmmL.js","assets/semantic--3HeS8qD.js","assets/index-BSDsIKGF.js","assets/visactor-DPdqLTJZ.js","assets/index-2v2s2rql.js"])))=>i.map(i=>d[i]);
import{j as e,S as De,T as $e,e as $,f as hu,g as Ve,h as he,B as P,F as se,i as X,k as Me,D as yu,M as fe,l as I,m as Qe,n as Ie,P as ve,L as ae,C as Be,o as uu,I as st,p as St,R as ge,q as ce,r as Ke,s as ku,A as Ou,t as He,u as wt,v as vt,w as kt,x as Su,y as _u,z as Tu,E as at,G as qe,H as rt,J as _t,K as Iu,N as lu,O as Wu,Q as it,U as lt,V as ot,W as Tt,X as It,Y as eu,Z as ct,$ as dt,a0 as Pt,a1 as $t,a2 as Mt,a3 as Rt,a4 as Ot,a5 as zt,a6 as Lt,a7 as Nt,a8 as Ut,a9 as Wt,aa as Kt}from"./semi-ui-BLcMfhPi.js";import{a as Ht,r as t,u as Oe,N as Gt,L as ou,R as Fu,e as zu,c as qt,g as Vt,f as Qt,h as Jt,i as Yt,j as pe,B as Zt}from"./react-core-D0qmaBEd.js";import{c as Xt,a as Lu}from"./tools-CIWJskKV.js";import{Q as en,_ as au,T as ht,f as wu,k as un}from"./react-components-BQX6XmmL.js";import{M as Pu,G as ru,F as G,H as ye,D as we,a as Eu,B as iu,I as Ft,S as Nu,b as tn,L as nn,c as Se}from"./semantic--3HeS8qD.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function c(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=c(o);fetch(o.href,i)}})();var $u={},Ku=Ht;$u.createRoot=Ku.createRoot,$u.hydrateRoot=Ku.hydrateRoot;const sn="modulepreload",an=function(u){return"/"+u},Hu={},Uu=function(n,c,a){let o=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),p=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.all(c.map(j=>{if(j=an(j),j in Hu)return;Hu[j]=!0;const v=j.endsWith(".css"),F=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${j}"]${F}`))return;const h=document.createElement("link");if(h.rel=v?"stylesheet":sn,v||(h.as="script",h.crossOrigin=""),h.href=j,p&&h.setAttribute("nonce",p),document.head.appendChild(h),v)return new Promise((l,E)=>{h.addEventListener("load",l),h.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${j}`)))})}))}return o.then(()=>n()).catch(i=>{const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=i,window.dispatchEvent(p),!p.defaultPrevented)throw i})},je=({prompt:u="page"})=>e.jsxs(De,{style:{height:100},spinning:!0,children:["加载",u,"中..."]}),rn=Xt(),de=10,ju=[{key:1,text:"OpenAI",value:1,color:"green",label:"OpenAI"},{key:2,text:"Midjourney Proxy",value:2,color:"light-blue",label:"Midjourney Proxy"},{key:5,text:"Midjourney Proxy Plus",value:5,color:"blue",label:"Midjourney Proxy Plus"},{key:36,text:"Suno API",value:36,color:"purple",label:"Suno API"},{key:4,text:"Ollama",value:4,color:"grey",label:"Ollama"},{key:14,text:"Anthropic Claude",value:14,color:"indigo",label:"Anthropic Claude"},{key:33,text:"AWS Claude",value:33,color:"indigo",label:"AWS Claude"},{key:3,text:"Azure OpenAI",value:3,color:"teal",label:"Azure OpenAI"},{key:24,text:"Google Gemini",value:24,color:"orange",label:"Google Gemini"},{key:34,text:"Cohere",value:34,color:"purple",label:"Cohere"},{key:15,text:"百度文心千帆",value:15,color:"blue",label:"百度文心千帆"},{key:17,text:"阿里通义千问",value:17,color:"orange",label:"阿里通义千问"},{key:18,text:"讯飞星火认知",value:18,color:"blue",label:"讯飞星火认知"},{key:16,text:"智谱 ChatGLM",value:16,color:"violet",label:"智谱 ChatGLM"},{key:26,text:"智谱 GLM-4V",value:26,color:"purple",label:"智谱 GLM-4V"},{key:11,text:"Google PaLM2",value:11,color:"orange",label:"Google PaLM2"},{key:39,text:"Cloudflare",value:39,color:"grey",label:"Cloudflare"},{key:25,text:"Moonshot",value:25,color:"green",label:"Moonshot"},{key:19,text:"360 智脑",value:19,color:"blue",label:"360 智脑"},{key:23,text:"腾讯混元",value:23,color:"teal",label:"腾讯混元"},{key:31,text:"零一万物",value:31,color:"green",label:"零一万物"},{key:35,text:"MiniMax",value:35,color:"green",label:"MiniMax"},{key:37,text:"Dify",value:37,color:"teal",label:"Dify"},{key:38,text:"Jina",value:38,color:"blue",label:"Jina"},{key:8,text:"自定义渠道",value:8,color:"pink",label:"自定义渠道"},{key:22,text:"知识库：FastGPT",value:22,color:"blue",label:"知识库：FastGPT"},{key:21,text:"知识库：AI Proxy",value:21,color:"purple",label:"知识库：AI Proxy"}],ln=({htmlContent:u})=>e.jsx("div",{dangerouslySetInnerHTML:{__html:u}});function ke(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=10):!1}function pt(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=100):!1}function Au(){let u=localStorage.getItem("system_name");return u||"New API"}function pu(){let u=localStorage.getItem("logo");return u||"/logo.png"}function mt(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.id):-1}function on(){return localStorage.getItem("footer_html")}async function Re(u){let n=!0;try{await navigator.clipboard.writeText(u)}catch(c){n=!1,console.error(c)}return n}function _e(){return window.innerWidth<=600}let gt={autoClose:!1};_e()&&(gt.position="top-center");function f(u){if(console.error(u),u.message){if(u.name==="AxiosError"){switch(u.response.status){case 401:window.location.href="/login?expired=true";break;case 429:$e.error("错误：请求次数过多，请稍后再试！");break;case 500:$e.error("错误：服务器内部错误，请联系管理员！");break;case 405:$e.info("本站仅作演示之用，无服务端！");break;default:$e.error("错误："+u.message)}return}$e.error("错误："+u.message)}else $e.error("错误："+u)}function Je(u){$e.warning(u)}function Y(u){$e.success(u)}function Ae(u){$e.info(u)}function Gu(u,n=!1){n?en(e.jsx(ln,{htmlContent:u}),gt):$e.info(u)}function Cu(u){return u.endsWith("/")?u.slice(0,-1):u}function Te(u){let n=new Date(u*1e3),c=n.getFullYear().toString(),a=(n.getMonth()+1).toString(),o=n.getDate().toString(),i=n.getHours().toString(),p=n.getMinutes().toString(),j=n.getSeconds().toString();return a.length===1&&(a="0"+a),o.length===1&&(o="0"+o),i.length===1&&(i="0"+i),p.length===1&&(p="0"+p),j.length===1&&(j="0"+j),c+"-"+a+"-"+o+" "+i+":"+p+":"+j}function Ys(u,n="hour"){let c=new Date(u*1e3),a=(c.getMonth()+1).toString(),o=c.getDate().toString(),i=c.getHours().toString();a.length===1&&(a="0"+a),o.length===1&&(o="0"+o),i.length===1&&(i="0"+i);let p=a+"-"+o;if(n==="hour")p+=" "+i+":00";else if(n==="week"){let j=new Date(u*1e3+5184e5),v=(j.getMonth()+1).toString(),F=j.getDate().toString();v.length===1&&(v="0"+v),F.length===1&&(F="0"+F),p+=" - "+v+"-"+F}return p}function cn(u,n){let c=new Blob([u],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(c),o=document.createElement("a");o.href=a,o.download=n,o.click()}const su=u=>{try{JSON.parse(u)}catch{return!1}return!0};function dn(u){return!localStorage.getItem(`prompt-${u}`)}function Ye(u,n){const c=[];for(const a in u)u.hasOwnProperty(a)&&n.hasOwnProperty(a)&&u[a]!==n[a]&&c.push({key:a,oldValue:u[a],newValue:n[a]});return c}var Du={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};let M=Lu.create({baseURL:Du.VITE_REACT_APP_SERVER_URL?Du.VITE_REACT_APP_SERVER_URL:"",headers:{"New-API-User":mt()}});function hn(){M=Lu.create({baseURL:Du.VITE_REACT_APP_SERVER_URL?Du.VITE_REACT_APP_SERVER_URL:"",headers:{"New-API-User":mt()}})}M.interceptors.response.use(u=>u,u=>{f(u)});function xt(u){if(u==="")return e.jsx($,{size:"large",children:"unknown"},"default");const n={vip:"yellow",pro:"yellow",svip:"red",premium:"red"},c=u.split(",").sort();return e.jsx("span",{children:c.map(a=>e.jsx($,{size:"large",color:n[a]||du(a),children:a},a))},u)}function Bu(u){return u>=1e9?(u/1e9).toFixed(1)+"B":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e4?(u/1e3).toFixed(1)+"k":u}function Zs(u,n=2){let c=localStorage.getItem("display_in_currency");return u=u.toFixed(n),c?"$"+u:u}function Fn(u){if(u=u.toFixed(2),u>=1e5){let n=u.toString(),c=n.indexOf("."),a=n,o="";return c!==-1&&(a=n.slice(0,c),o=n.slice(c)),a.slice(0,2)+".."+a.slice(-2)+o}return u}function fu(){let u=localStorage.getItem("quota_per_unit");return u=parseFloat(u),u}function pn(u){let n=localStorage.getItem("quota_per_unit");return n=parseFloat(n),u=parseFloat(u),n*u}function Xs(u,n=6){let c=localStorage.getItem("quota_per_unit");return c=parseFloat(c),(u/c).toFixed(n)}function mn(u){let n=localStorage.getItem("display_in_currency");return n=n==="true",n?"$"+u:pn(u)}function me(u,n=2){let c=localStorage.getItem("quota_per_unit"),a=localStorage.getItem("display_in_currency");return c=parseFloat(c),a=a==="true",a?"$"+(u/c).toFixed(n):Bu(u)}function gn(u,n,c,a=-1,o,i){if(a!==-1)return"模型价格：$"+a+" * 分组倍率："+i+" = $"+a*i;{o===void 0&&(o=0);let p=c*2,j=c*2*o,v=u/1e6*p*i+n/1e6*j*i;return e.jsx(e.Fragment,{children:e.jsxs("article",{children:[e.jsxs("p",{children:["提示：$",p," * ",i," = $",p*i," / 1M tokens"]}),e.jsxs("p",{children:["补全：$",j," * ",i," = $",j*i," / 1M tokens"]}),e.jsx("p",{}),e.jsxs("p",{children:["提示 ",u," tokens / 1M tokens * $",p," + 补全"," ",n," tokens / 1M tokens * $",j," * 分组 ",i," = $",v.toFixed(6)]}),e.jsx("p",{children:"仅供参考，以实际扣费为准"})]})})}}function cu(u,n){let c=localStorage.getItem("display_in_currency");return c=c==="true",c?`（等价金额：${me(u,n)}）`:""}const qu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"],ea={"dall-e":"rgb(147,112,219)","dall-e-3":"rgb(153,50,204)","gpt-3.5-turbo":"rgb(184,227,167)","gpt-3.5-turbo-0613":"rgb(60,179,113)","gpt-3.5-turbo-1106":"rgb(32,178,170)","gpt-3.5-turbo-16k":"rgb(149,252,206)","gpt-3.5-turbo-16k-0613":"rgb(119,255,214)","gpt-3.5-turbo-instruct":"rgb(175,238,238)","gpt-4":"rgb(135,206,235)","gpt-4-0613":"rgb(100,149,237)","gpt-4-1106-preview":"rgb(30,144,255)","gpt-4-0125-preview":"rgb(2,177,236)","gpt-4-turbo-preview":"rgb(2,177,255)","gpt-4-32k":"rgb(104,111,238)","gpt-4-32k-0613":"rgb(61,71,139)","gpt-4-all":"rgb(65,105,225)","gpt-4-gizmo-*":"rgb(0,0,255)","gpt-4-vision-preview":"rgb(25,25,112)","text-ada-001":"rgb(255,192,203)","text-babbage-001":"rgb(255,160,122)","text-curie-001":"rgb(219,112,147)","text-davinci-003":"rgb(219,112,147)","text-davinci-edit-001":"rgb(255,105,180)","text-embedding-ada-002":"rgb(255,182,193)","text-embedding-v1":"rgb(255,174,185)","text-moderation-latest":"rgb(255,130,171)","text-moderation-stable":"rgb(255,160,122)","tts-1":"rgb(255,140,0)","tts-1-1106":"rgb(255,165,0)","tts-1-hd":"rgb(255,215,0)","tts-1-hd-1106":"rgb(255,223,0)","whisper-1":"rgb(245,245,220)","claude-3-opus-20240229":"rgb(255,132,31)","claude-3-sonnet-20240229":"rgb(253,135,93)","claude-3-haiku-20240307":"rgb(255,175,146)","claude-2.1":"rgb(255,209,190)"};function du(u){let n=0;for(let a=0;a<u.length;a++)n+=u.charCodeAt(a);let c=n%qu.length;return qu[c]}const xn=u=>{const n={username:"",display_name:"",password:""},[c,a]=t.useState(n),[o,i]=t.useState(!1),{username:p,display_name:j,password:v}=c,F=(E,k)=>{a(z=>({...z,[E]:k}))},h=async()=>{if(i(!0),c.username===""||c.password==="")return;const E=await M.post("/api/user/",c),{success:k,message:z}=E.data;k?(Y("用户账户创建成功！"),a(n),u.refresh(),u.handleClose()):f(z),i(!1)},l=()=>{u.handleClose()};return e.jsx(e.Fragment,{children:e.jsx(hu,{placement:"left",title:e.jsx(Ve,{level:3,children:"添加用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(he,{children:[e.jsx(P,{theme:"solid",size:"large",onClick:h,children:"提交"}),e.jsx(P,{theme:"solid",size:"large",type:"tertiary",onClick:l,children:"取消"})]})}),closeIcon:null,onCancel:()=>l(),width:_e()?"100%":600,children:e.jsxs(De,{spinning:o,children:[e.jsx(se,{style:{marginTop:20},label:"用户名",name:"username",addonBefore:"用户名",placeholder:"请输入用户名",onChange:E=>F("username",E),value:p,autoComplete:"off"}),e.jsx(se,{style:{marginTop:20},addonBefore:"显示名",label:"显示名称",name:"display_name",autoComplete:"off",placeholder:"请输入显示名称",onChange:E=>F("display_name",E),value:j}),e.jsx(se,{style:{marginTop:20},label:"密 码",name:"password",type:"password",addonBefore:"密码",placeholder:"请输入密码",onChange:E=>F("password",E),value:v,autoComplete:"off"})]})})})},Mu=u=>{const n=u.editingUser.id,[c,a]=t.useState(!0),[o,i]=t.useState(!1),[p,j]=t.useState(""),[v,F]=t.useState({username:"",display_name:"",password:"",github_id:"",wechat_id:"",email:"",quota:0,group:"default"}),[h,l]=t.useState([]),{username:E,display_name:k,password:z,github_id:_,wechat_id:N,telegram_id:w,email:V,quota:H,group:W}=v,Z=(x,R)=>{F(C=>({...C,[x]:R}))},Q=async()=>{try{let x=await M.get("/api/group/");l(x.data.data.map(R=>({label:R,value:R})))}catch(x){f(x.message)}};Oe();const ee=()=>{u.handleClose()},te=async()=>{a(!0);let x;n?x=await M.get(`/api/user/${n}`):x=await M.get("/api/user/self");const{success:R,message:C,data:A}=x.data;R?(A.password="",F(A)):f(C),a(!1)};t.useEffect(()=>{te().then(),n&&Q().then()},[u.editingUser.id]);const K=async()=>{a(!0);let x;if(n){let A={...v,id:parseInt(n)};typeof A.quota=="string"&&(A.quota=parseInt(A.quota)),x=await M.put("/api/user/",A)}else x=await M.put("/api/user/self",v);const{success:R,message:C}=x.data;R?(Y("用户信息更新成功！"),u.refresh(),u.handleClose()):f(C),a(!1)},b=()=>{let x=parseInt(H)+parseInt(p);F(R=>({...R,quota:x}))},g=()=>{j("0"),i(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(hu,{placement:"right",title:e.jsx(Ve,{level:3,children:"编辑用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(he,{children:[e.jsx(P,{theme:"solid",size:"large",onClick:K,children:"提交"}),e.jsx(P,{theme:"solid",size:"large",type:"tertiary",onClick:ee,children:"取消"})]})}),closeIcon:null,onCancel:()=>ee(),width:_e()?"100%":600,children:e.jsxs(De,{spinning:c,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"用户名"})}),e.jsx(se,{label:"用户名",name:"username",placeholder:"请输入新的用户名",onChange:x=>Z("username",x),value:E,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"密码"})}),e.jsx(se,{label:"密码",name:"password",type:"password",placeholder:"请输入新的密码，最短 8 位",onChange:x=>Z("password",x),value:z,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"显示名称"})}),e.jsx(se,{label:"显示名称",name:"display_name",placeholder:"请输入新的显示名称",onChange:x=>Z("display_name",x),value:k,autoComplete:"new-password"}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"分组"})}),e.jsx(Me,{placeholder:"请选择分组",name:"group",fluid:!0,search:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:x=>Z("group",x),value:v.group,autoComplete:"new-password",optionList:h}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:`剩余额度${cu(H)}`})}),e.jsxs(he,{children:[e.jsx(se,{name:"quota",placeholder:"请输入新的剩余额度",onChange:x=>Z("quota",x),value:H,type:"number",autoComplete:"new-password"}),e.jsx(P,{onClick:g,children:"添加额度"})]})]}),e.jsx(yu,{style:{marginTop:20},children:"以下信息不可修改"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"已绑定的 GitHub 账户"})}),e.jsx(se,{name:"github_id",value:_,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"已绑定的微信账户"})}),e.jsx(se,{name:"wechat_id",value:N,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"已绑定的邮箱账户"})}),e.jsx(se,{name:"email",value:V,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"已绑定的Telegram账户"})}),e.jsx(se,{name:"telegram_id",value:w,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0})]})}),e.jsxs(fe,{centered:!0,visible:o,onOk:()=>{b(),i(!1)},onCancel:()=>i(!1),closable:null,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:`新额度${me(H)} + ${me(p)} = ${me(H+parseInt(p))}`})}),e.jsx(se,{name:"addQuotaLocal",placeholder:"需要添加的额度（支持负数）",onChange:x=>{j(x)},value:p,type:"number",autoComplete:"new-password"})]})]})};function En(u){switch(u){case 1:return e.jsx($,{size:"large",children:"普通用户"});case 10:return e.jsx($,{color:"yellow",size:"large",children:"管理员"});case 100:return e.jsx($,{color:"orange",size:"large",children:"超级管理员"});default:return e.jsx($,{color:"red",size:"large",children:"未知身份"})}}const Cn=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"用户名",dataIndex:"username"},{title:"分组",dataIndex:"group",render:(d,D,B)=>e.jsx("div",{children:xt(d)})},{title:"统计信息",dataIndex:"info",render:(d,D,B)=>e.jsx("div",{children:e.jsxs(he,{spacing:1,children:[e.jsx(Ie,{content:"剩余额度",children:e.jsx($,{color:"white",size:"large",children:me(D.quota)})}),e.jsx(Ie,{content:"已用额度",children:e.jsx($,{color:"white",size:"large",children:me(D.used_quota)})}),e.jsx(Ie,{content:"调用次数",children:e.jsx($,{color:"white",size:"large",children:Bu(D.request_count)})})]})})},{title:"邀请信息",dataIndex:"invite",render:(d,D,B)=>e.jsx("div",{children:e.jsxs(he,{spacing:1,children:[e.jsx(Ie,{content:"邀请人数",children:e.jsx($,{color:"white",size:"large",children:Bu(D.aff_count)})}),e.jsx(Ie,{content:"邀请总收益",children:e.jsx($,{color:"white",size:"large",children:me(D.aff_history_quota)})}),e.jsx(Ie,{content:"邀请人ID",children:D.inviter_id===0?e.jsx($,{color:"white",size:"large",children:"无"}):e.jsx($,{color:"white",size:"large",children:D.inviter_id})})]})})},{title:"角色",dataIndex:"role",render:(d,D,B)=>e.jsx("div",{children:En(d)})},{title:"状态",dataIndex:"status",render:(d,D,B)=>e.jsx("div",{children:D.DeletedAt!==null?e.jsx($,{color:"red",children:"已注销"}):g(d)})},{title:"",dataIndex:"operate",render:(d,D,B)=>e.jsx("div",{children:D.DeletedAt!==null?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:()=>{b(D.username,"promote",D)},children:e.jsx(P,{theme:"light",type:"warning",style:{marginRight:1},children:"提升"})}),e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:()=>{b(D.username,"demote",D)},children:e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:1},children:"降级"})}),D.status===1?e.jsx(P,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{b(D.username,"disable",D)},children:"禁用"}):e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{b(D.username,"enable",D)},disabled:D.status===3,children:"启用"}),e.jsx(P,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{Q(D),W(!0)},children:"编辑"}),e.jsx(ve,{title:"确定是否要注销此用户？",content:"相当于删除用户，此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{b(D.username,"delete",D).then(()=>{te(D.id)})},children:e.jsx(P,{theme:"light",type:"danger",style:{marginRight:1},children:"注销"})})]})})}],[n,c]=t.useState([]),[a,o]=t.useState(!0),[i,p]=t.useState(1),[j,v]=t.useState(""),[F,h]=t.useState(!1),[l,E]=t.useState(""),[k,z]=t.useState([]),[_,N]=t.useState(de),[w,V]=t.useState(!1),[H,W]=t.useState(!1),[Z,Q]=t.useState({id:void 0}),ee=d=>{d.length>=i*de?N(d.length+1):N(d.length)},te=d=>{let D=[...n];if(d!=null){let B=D.findIndex(L=>L.id===d);B>-1&&(D[B].DeletedAt=new Date,c(D))}},K=async d=>{const D=await M.get(`/api/user/?p=${d}`),{success:B,message:L,data:J}=D.data;if(B)if(d===0)c(J),ee(J);else{let y=n;y.push(...J),c(y),ee(y)}else f(L);o(!1)};t.useEffect(()=>{K(0).then().catch(d=>{f(d)}),S().then()},[]);const b=async(d,D,B)=>{const L=await M.post("/api/user/manage",{username:d,action:D}),{success:J,message:y}=L.data;if(J){Y("操作成功完成！");let U=L.data.data,ue=[...n];D==="delete"||(B.status=U.status,B.role=U.role),c(ue)}else f(y)},g=d=>{switch(d){case 1:return e.jsx($,{size:"large",children:"已激活"});case 2:return e.jsx($,{size:"large",color:"red",children:"已封禁"});default:return e.jsx($,{size:"large",color:"grey",children:"未知状态"})}},x=async(d,D)=>{if(d===""&&D===""){await K(0),p(1);return}h(!0);const B=await M.get(`/api/user/search?keyword=${d}&group=${D}`),{success:L,message:J,data:y}=B.data;L?(c(y),p(1)):f(J),h(!1)},R=async d=>{v(d.trim())},C=d=>{p(d),d===Math.ceil(n.length/de)+1&&K(d-1).then(D=>{})},A=n.slice((i-1)*de,i*de),s=()=>{V(!1)},r=()=>{W(!1),Q({id:void 0})},m=async()=>{j===""?await K(i-1):await x()},S=async()=>{try{let d=await M.get("/api/group/");if(d===void 0)return;z(d.data.data.map(D=>({label:D,value:D})))}catch(d){f(d.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(xn,{refresh:m,visible:w,handleClose:s}),e.jsx(Mu,{refresh:m,visible:H,handleClose:r,editingUser:Z}),e.jsx(I,{onSubmit:()=>{x(j,l)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(he,{children:[e.jsx(I.Input,{label:"搜索关键字",icon:"search",field:"keyword",iconPosition:"left",placeholder:"搜索用户的 ID，用户名，显示名称，以及邮箱地址 ...",value:j,loading:F,onChange:d=>R(d)}),e.jsx(I.Select,{field:"group",label:"分组",optionList:k,onChange:d=>{E(d),x(j,d)}}),e.jsx(P,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx(Qe,{columns:u,dataSource:A,pagination:{currentPage:i,pageSize:de,total:_,pageSizeOpts:[10,20,50,100],onPageChange:C},loading:a}),e.jsx(P,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{V(!0)},children:"添加用户"})]})},fn=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理用户"})}),e.jsx(ae.Content,{children:e.jsx(Cn,{})})]})});function Ue({children:u}){return localStorage.getItem("user")?u:e.jsx(Gt,{to:"/login",state:{from:rn.location}})}const jn=()=>{const[u,n]=t.useState({username:"",password:"",password2:"",email:"",verification_code:""}),{username:c,password:a,password2:o}=u,[i,p]=t.useState(!1),[j,v]=t.useState(!1),[F,h]=t.useState(""),[l,E]=t.useState(""),[k,z]=t.useState(!1);pu();let _=new URLSearchParams(window.location.search).get("aff");_&&localStorage.setItem("aff",_),t.useEffect(()=>{let W=localStorage.getItem("status");W&&(W=JSON.parse(W),p(W.email_verification),W.turnstile_check&&(v(!0),h(W.turnstile_site_key)))});let N=Oe();function w(W,Z){n(Q=>({...Q,[W]:Z}))}async function V(W){if(a.length<8){Ae("密码长度不得小于 8 位！");return}if(a!==o){Ae("两次输入的密码不一致");return}if(c&&a){if(j&&l===""){Ae("请稍后几秒重试，Turnstile 正在检查用户环境！");return}z(!0),_||(_=localStorage.getItem("aff")),u.aff_code=_;const Z=await M.post(`/api/user/register?turnstile=${l}`,u),{success:Q,message:ee}=Z.data;Q?(N("/login"),Y("注册成功！")):f(ee),z(!1)}}const H=async()=>{if(u.email==="")return;if(j&&l===""){Ae("请稍后几秒重试，Turnstile 正在检查用户环境！");return}z(!0);const W=await M.get(`/api/verification?email=${u.email}&turnstile=${l}`),{success:Z,message:Q}=W.data;Z?Y("验证码发送成功，请检查你的邮箱！"):f(Q),z(!1)};return e.jsx("div",{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{}),e.jsx(ae.Content,{children:e.jsx("div",{style:{justifyContent:"center",display:"flex",marginTop:120},children:e.jsxs("div",{style:{width:500},children:[e.jsxs(Be,{children:[e.jsx(Ve,{heading:2,style:{textAlign:"center"},children:"新用户注册"}),e.jsxs(I,{size:"large",children:[e.jsx(I.Input,{field:"username",label:"用户名",placeholder:"用户名",name:"username",onChange:W=>w("username",W)}),e.jsx(I.Input,{field:"password",label:"密码",placeholder:"密码，最短 8 位，最长 20 位",name:"password",type:"password",onChange:W=>w("password",W)}),e.jsx(I.Input,{field:"password2",label:"确认密码",placeholder:"确认密码",name:"password2",type:"password",onChange:W=>w("password2",W)}),i?e.jsxs(e.Fragment,{children:[e.jsx(I.Input,{field:"email",label:"邮箱",placeholder:"输入邮箱地址",onChange:W=>w("email",W),name:"email",type:"email",suffix:e.jsx(P,{onClick:H,disabled:k,children:"获取验证码"})}),e.jsx(I.Input,{field:"verification_code",label:"验证码",placeholder:"输入验证码",onChange:W=>w("verification_code",W),name:"verification_code"})]}):e.jsx(e.Fragment,{}),e.jsx(P,{theme:"solid",style:{width:"100%"},type:"primary",size:"large",htmlType:"submit",onClick:V,children:"注册"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginTop:20},children:e.jsxs(uu,{children:["已有账户？",e.jsx(ou,{to:"/login",children:"点击登录"})]})})]}),j?e.jsx(au,{sitekey:F,onVerify:W=>{E(W)}}):e.jsx(e.Fragment,{})]})})})]})})},yn=(u,n)=>{switch(n.type){case"login":return{...u,user:n.payload};case"logout":return{...u,user:void 0};default:return u}},Et={user:void 0},Ze=Fu.createContext({state:Et,dispatch:()=>null}),Dn=({children:u})=>{const[n,c]=Fu.useReducer(yn,Et);return e.jsx(Ze.Provider,{value:[n,c],children:u})};async function Bn(){const u=await M.get("/api/oauth/state"),{success:n,message:c,data:a}=u.data;return n?a:(f(c),"")}async function Ct(u){const n=await Bn();n&&window.open(`https://github.com/login/oauth/authorize?client_id=${u}&state=${n}&scope=user:email`)}let Ge;async function An(){const u=await M.get("/api/models"),{success:n,data:c}=u.data;n&&(Ge=c,localStorage.setItem("channel_models",JSON.stringify(c)))}function vu(u){if(Ge!==void 0&&u in Ge)return Ge[u]?Ge[u]:[];let n=localStorage.getItem("channel_models");return n?(Ge=JSON.parse(n),u in Ge?Ge[u]:[]):[]}const bn=()=>{function u(){return e.jsxs("svg",{t:"1709714447384",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5091",width:"16",height:"16",children:[e.jsx("path",{d:"M690.1 377.4c5.9 0 11.8 0.2 17.6 0.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6 5.5 3.9 9.1 10.3 9.1 17.6 0 2.4-0.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-0.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-0.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4 0.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-0.1 17.8-0.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8z m-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1z m-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1z","p-id":"5092"}),e.jsx("path",{d:"M866.7 792.7c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-0.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7 2.4 0 4.7-0.9 6.4-2.6 1.7-1.7 2.6-4 2.6-6.4 0-2.2-0.9-4.4-1.4-6.6-0.3-1.2-7.6-28.3-12.2-45.3-0.5-1.9-0.9-3.8-0.9-5.7 0.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9z m179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c-0.1 19.8-16.2 35.9-36 35.9z","p-id":"5093"})]})}return e.jsx("div",{children:e.jsx(st,{svg:e.jsx(u,{})})})};function Sn(u){localStorage.setItem("status",JSON.stringify(u)),localStorage.setItem("system_name",u.system_name),localStorage.setItem("logo",u.logo),localStorage.setItem("footer_html",u.footer_html),localStorage.setItem("quota_per_unit",u.quota_per_unit),localStorage.setItem("display_in_currency",u.display_in_currency),localStorage.setItem("enable_drawing",u.enable_drawing),localStorage.setItem("enable_task",u.enable_task),localStorage.setItem("enable_data_export",u.enable_data_export),localStorage.setItem("data_export_default_time",u.data_export_default_time),localStorage.setItem("default_collapse_sidebar",u.default_collapse_sidebar),localStorage.setItem("mj_notify_enabled",u.mj_notify_enabled),u.chat_link?localStorage.setItem("chat_link",u.chat_link):localStorage.removeItem("chat_link"),u.chat_link2?localStorage.setItem("chat_link2",u.chat_link2):localStorage.removeItem("chat_link2")}function wn(u){localStorage.setItem("user",JSON.stringify(u))}const vn=()=>{const[u,n]=t.useState({username:"",password:"",wechat_verification_code:""}),[c,a]=zu(),[o,i]=t.useState(!1),{username:p,password:j}=u,[v,F]=t.useContext(Ze),[h,l]=t.useState(!1),[E,k]=t.useState(""),[z,_]=t.useState("");let N=Oe();const[w,V]=t.useState({});pu(),t.useEffect(()=>{c.get("expired")&&f("未登录或登录已过期，请重新登录！");let b=localStorage.getItem("status");b&&(b=JSON.parse(b),V(b),b.turnstile_check&&(l(!0),k(b.turnstile_site_key)))},[]);const[H,W]=t.useState(!1),Z=()=>{W(!0)},Q=async()=>{if(h&&z===""){Ae("请稍后几秒重试，Turnstile 正在检查用户环境！");return}const b=await M.get(`/api/oauth/wechat?code=${u.wechat_verification_code}`),{success:g,message:x,data:R}=b.data;g?(F({type:"login",payload:R}),localStorage.setItem("user",JSON.stringify(R)),N("/"),Y("登录成功！"),W(!1)):f(x)};function ee(b,g){n(x=>({...x,[b]:g}))}async function te(b){if(h&&z===""){Ae("请稍后几秒重试，Turnstile 正在检查用户环境！");return}if(i(!0),p&&j){const g=await M.post(`/api/user/login?turnstile=${z}`,{username:p,password:j}),{success:x,message:R,data:C}=g.data;x?(F({type:"login",payload:C}),wn(C),hn(),Y("登录成功！"),p==="root"&&j==="123456"&&fe.error({title:"您正在使用默认密码！",content:"请立刻修改默认密码！",centered:!0}),N("/token")):f(R)}else f("请输入用户名和密码！")}const K=async b=>{const g=["id","first_name","last_name","username","photo_url","auth_date","hash","lang"],x={};g.forEach(r=>{b[r]&&(x[r]=b[r])});const R=await M.get("/api/oauth/telegram/login",{params:x}),{success:C,message:A,data:s}=R.data;C?(F({type:"login",payload:s}),localStorage.setItem("user",JSON.stringify(s)),Y("登录成功！"),N("/")):f(A)};return e.jsx("div",{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{}),e.jsx(ae.Content,{children:e.jsx("div",{style:{justifyContent:"center",display:"flex",marginTop:120},children:e.jsxs("div",{style:{width:500},children:[e.jsxs(Be,{children:[e.jsx(Ve,{heading:2,style:{textAlign:"center"},children:"用户登录"}),e.jsxs(I,{children:[e.jsx(I.Input,{field:"username",label:"用户名",placeholder:"用户名",name:"username",onChange:b=>ee("username",b)}),e.jsx(I.Input,{field:"password",label:"密码",placeholder:"密码",name:"password",type:"password",onChange:b=>ee("password",b)}),e.jsx(P,{theme:"solid",style:{width:"100%"},type:"primary",size:"large",htmlType:"submit",onClick:te,children:"登录"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:20},children:[e.jsxs(uu,{children:["没有账号请先 ",e.jsx(ou,{to:"/register",children:"注册账号"})]}),e.jsxs(uu,{children:["忘记密码 ",e.jsx(ou,{to:"/reset",children:"点击重置"})]})]}),w.github_oauth||w.wechat_login||w.telegram_oauth?e.jsxs(e.Fragment,{children:[e.jsx(yu,{margin:"12px",align:"center",children:"第三方登录"}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:[w.github_oauth?e.jsx(P,{type:"primary",icon:e.jsx(St,{}),onClick:()=>Ct(w.github_client_id)}):e.jsx(e.Fragment,{}),w.wechat_login?e.jsx(P,{type:"primary",style:{color:"rgba(var(--semi-green-5), 1)"},icon:e.jsx(st,{svg:e.jsx(bn,{})}),onClick:Z}):e.jsx(e.Fragment,{})]}),w.telegram_oauth?e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:5},children:e.jsx(ht,{dataOnauth:K,botName:w.telegram_bot_name})})}):e.jsx(e.Fragment,{})]}):e.jsx(e.Fragment,{}),e.jsxs(fe,{title:"微信扫码登录",visible:H,maskClosable:!0,onOk:Q,onCancel:()=>W(!1),okText:"登录",size:"small",centered:!0,children:[e.jsx("div",{style:{display:"flex",alignItem:"center",flexDirection:"column"},children:e.jsx("img",{src:w.wechat_qrcode})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(I,{size:"large",children:e.jsx(I.Input,{field:"wechat_verification_code",placeholder:"验证码",label:"验证码",value:u.wechat_verification_code,onChange:b=>ee("wechat_verification_code",b)})})]})]}),h?e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:e.jsx(au,{sitekey:E,onVerify:b=>{_(b)}})}):e.jsx(e.Fragment,{})]})})})]})})},kn=()=>e.jsx(e.Fragment,{children:e.jsxs(Pu,{negative:!0,children:[e.jsx(Pu.Header,{children:"页面不存在"}),e.jsx("p",{children:"请检查你的浏览器地址是否正确"})]})}),ft=t.createContext(null),jt=()=>t.useContext(ft),yt=t.createContext(null),_n=()=>t.useContext(yt),Tn=({children:u})=>{const[n,c]=t.useState(()=>{try{return localStorage.getItem("theme-mode")||null}catch{return null}}),a=t.useCallback(o=>{c(o?"dark":"light");const i=document.body;o?(i.setAttribute("theme-mode","dark"),localStorage.setItem("theme-mode","dark")):(i.removeAttribute("theme-mode"),localStorage.setItem("theme-mode","light"))},[]);return e.jsx(yt.Provider,{value:a,children:e.jsx(ft.Provider,{value:n,children:u})})},In=()=>{let[u,n]=t.useState({PasswordLoginEnabled:"",PasswordRegisterEnabled:"",EmailVerificationEnabled:"",GitHubOAuthEnabled:"",GitHubClientId:"",GitHubClientSecret:"",Notice:"",SMTPServer:"",SMTPPort:"",SMTPAccount:"",SMTPFrom:"",SMTPToken:"",ServerAddress:"",WorkerUrl:"",WorkerValidKey:"",EpayId:"",EpayKey:"",Price:7.3,MinTopUp:1,TopupGroupRatio:"",PayAddress:"",CustomCallbackAddress:"",Footer:"",WeChatAuthEnabled:"",WeChatServerAddress:"",WeChatServerToken:"",WeChatAccountQRCodeImageURL:"",TurnstileCheckEnabled:"",TurnstileSiteKey:"",TurnstileSecretKey:"",RegisterEnabled:"",EmailDomainRestrictionEnabled:"",EmailAliasRestrictionEnabled:"",SMTPSSLEnabled:"",EmailDomainWhitelist:[],TelegramOAuthEnabled:"",TelegramBotToken:"",TelegramBotName:""});const[c,a]=t.useState({});let[o,i]=t.useState(!1);const[p,j]=t.useState([]),[v,F]=t.useState(""),[h,l]=t.useState(!1),k=jt()==="dark",z=async()=>{const g=await M.get("/api/option/"),{success:x,message:R,data:C}=g.data;if(x){let A={};C.forEach(s=>{s.key==="TopupGroupRatio"&&(s.value=JSON.stringify(JSON.parse(s.value),null,2)),A[s.key]=s.value}),n({...A,EmailDomainWhitelist:A.EmailDomainWhitelist.split(",")}),a(A),j(A.EmailDomainWhitelist.split(",").map(s=>({key:s,text:s,value:s})))}else f(R)};t.useEffect(()=>{z().then()},[]),t.useEffect(()=>{},[u.EmailDomainWhitelist]);const _=async(g,x)=>{switch(i(!0),g){case"PasswordLoginEnabled":case"PasswordRegisterEnabled":case"EmailVerificationEnabled":case"GitHubOAuthEnabled":case"WeChatAuthEnabled":case"TelegramOAuthEnabled":case"TurnstileCheckEnabled":case"EmailDomainRestrictionEnabled":case"EmailAliasRestrictionEnabled":case"SMTPSSLEnabled":case"RegisterEnabled":x=u[g]==="true"?"false":"true";break}const R=await M.put("/api/option/",{key:g,value:x}),{success:C,message:A}=R.data;C?(g==="EmailDomainWhitelist"&&(x=x.split(",")),g==="Price"&&(x=parseFloat(x)),n(s=>({...s,[g]:x}))):f(A),i(!1)},N=async(g,{name:x,value:R})=>{if(x==="PasswordLoginEnabled"&&u[x]==="true"){l(!0);return}x==="Notice"||x.startsWith("SMTP")&&x!=="SMTPSSLEnabled"||x==="ServerAddress"||x==="WorkerUrl"||x==="WorkerValidKey"||x==="EpayId"||x==="EpayKey"||x==="Price"||x==="PayAddress"||x==="GitHubClientId"||x==="GitHubClientSecret"||x==="WeChatServerAddress"||x==="WeChatServerToken"||x==="WeChatAccountQRCodeImageURL"||x==="TurnstileSiteKey"||x==="TurnstileSecretKey"||x==="EmailDomainWhitelist"||x==="TopupGroupRatio"||x==="TelegramBotToken"||x==="TelegramBotName"?n(C=>({...C,[x]:R})):await _(x,R)},w=async()=>{let g=Cu(u.ServerAddress);await _("ServerAddress",g)},V=async()=>{let g=Cu(u.WorkerUrl);await _("WorkerUrl",g),u.WorkerValidKey!==""&&await _("WorkerValidKey",u.WorkerValidKey)},H=async()=>{if(u.ServerAddress===""){f("请先填写服务器地址");return}if(c.TopupGroupRatio!==u.TopupGroupRatio){if(!su(u.TopupGroupRatio)){f("充值分组倍率不是合法的 JSON 字符串");return}await _("TopupGroupRatio",u.TopupGroupRatio)}let g=Cu(u.PayAddress);await _("PayAddress",g),u.EpayId!==""&&await _("EpayId",u.EpayId),u.EpayKey!==void 0&&u.EpayKey!==""&&await _("EpayKey",u.EpayKey),await _("Price",""+u.Price)},W=async()=>{c.SMTPServer!==u.SMTPServer&&await _("SMTPServer",u.SMTPServer),c.SMTPAccount!==u.SMTPAccount&&await _("SMTPAccount",u.SMTPAccount),c.SMTPFrom!==u.SMTPFrom&&await _("SMTPFrom",u.SMTPFrom),c.SMTPPort!==u.SMTPPort&&u.SMTPPort!==""&&await _("SMTPPort",u.SMTPPort),c.SMTPToken!==u.SMTPToken&&u.SMTPToken!==""&&await _("SMTPToken",u.SMTPToken)},Z=async()=>{c.EmailDomainWhitelist!==u.EmailDomainWhitelist.join(",")&&u.SMTPToken!==""&&await _("EmailDomainWhitelist",u.EmailDomainWhitelist.join(","))},Q=async()=>{c.WeChatServerAddress!==u.WeChatServerAddress&&await _("WeChatServerAddress",Cu(u.WeChatServerAddress)),c.WeChatAccountQRCodeImageURL!==u.WeChatAccountQRCodeImageURL&&await _("WeChatAccountQRCodeImageURL",u.WeChatAccountQRCodeImageURL),c.WeChatServerToken!==u.WeChatServerToken&&u.WeChatServerToken!==""&&await _("WeChatServerToken",u.WeChatServerToken)},ee=async()=>{c.GitHubClientId!==u.GitHubClientId&&await _("GitHubClientId",u.GitHubClientId),c.GitHubClientSecret!==u.GitHubClientSecret&&u.GitHubClientSecret!==""&&await _("GitHubClientSecret",u.GitHubClientSecret)},te=async()=>{await _("TelegramBotToken",u.TelegramBotToken),await _("TelegramBotName",u.TelegramBotName)},K=async()=>{c.TurnstileSiteKey!==u.TurnstileSiteKey&&await _("TurnstileSiteKey",u.TurnstileSiteKey),c.TurnstileSecretKey!==u.TurnstileSecretKey&&u.TurnstileSecretKey!==""&&await _("TurnstileSecretKey",u.TurnstileSecretKey)},b=()=>{const g=u.EmailDomainWhitelist;v!==""&&!g.includes(v)&&(F(""),n({...u,EmailDomainWhitelist:[...g,v]}),j([...p,{key:v,text:v,value:v}]))};return e.jsx(ru,{columns:1,children:e.jsx(ru.Column,{children:e.jsxs(G,{loading:o,inverted:k,children:[e.jsx(ye,{as:"h3",inverted:k,children:"通用设置"}),e.jsx(G.Group,{widths:"equal",children:e.jsx(G.Input,{label:"服务器地址",placeholder:"例如：https://yourdomain.com",value:u.ServerAddress,name:"ServerAddress",onChange:N})}),e.jsx(G.Button,{onClick:w,children:"更新服务器地址"}),e.jsxs(ye,{as:"h3",inverted:k,children:["代理设置（支持 ",e.jsx("a",{href:"https://github.com/Calcium-Ion/new-api-worker",target:"_blank",rel:"noreferrer",children:"new-api-worker"}),"）"]}),e.jsxs(G.Group,{widths:"equal",children:[e.jsx(G.Input,{label:"Worker地址，不填写则不启用代理",placeholder:"例如：https://workername.yourdomain.workers.dev",value:u.WorkerUrl,name:"WorkerUrl",onChange:N}),e.jsx(G.Input,{label:"Worker密钥，根据你部署的 Worker 填写",placeholder:"例如：your_secret_key",value:u.WorkerValidKey,name:"WorkerValidKey",onChange:N})]}),e.jsx(G.Button,{onClick:V,children:"更新Worker设置"}),e.jsx(we,{}),e.jsx(ye,{as:"h3",inverted:k,children:"支付设置（当前仅支持易支付接口，默认使用上方服务器地址作为回调地址！）"}),e.jsxs(G.Group,{widths:"equal",children:[e.jsx(G.Input,{label:"支付地址，不填写则不启用在线支付",placeholder:"例如：https://yourdomain.com",value:u.PayAddress,name:"PayAddress",onChange:N}),e.jsx(G.Input,{label:"易支付商户ID",placeholder:"例如：0001",value:u.EpayId,name:"EpayId",onChange:N}),e.jsx(G.Input,{label:"易支付商户密钥",placeholder:"敏感信息不会发送到前端显示",value:u.EpayKey,name:"EpayKey",onChange:N})]}),e.jsxs(G.Group,{widths:"equal",children:[e.jsx(G.Input,{label:"回调地址，不填写则使用上方服务器地址作为回调地址",placeholder:"例如：https://yourdomain.com",value:u.CustomCallbackAddress,name:"CustomCallbackAddress",onChange:N}),e.jsx(G.Input,{label:"充值价格（x元/美金）",placeholder:"例如：7，就是7元/美金",value:u.Price,name:"Price",min:0,onChange:N}),e.jsx(G.Input,{label:"最低充值美元数量（以美金为单位，如果使用额度请自行换算！）",placeholder:"例如：2，就是最低充值2$",value:u.MinTopUp,name:"MinTopUp",min:1,onChange:N})]}),e.jsx(G.Group,{widths:"equal",children:e.jsx(G.TextArea,{label:"充值分组倍率",name:"TopupGroupRatio",onChange:N,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:u.TopupGroupRatio,placeholder:"为一个 JSON 文本，键为组名称，值为倍率"})}),e.jsx(G.Button,{onClick:H,children:"更新支付设置"}),e.jsx(we,{}),e.jsx(ye,{as:"h3",inverted:k,children:"配置登录注册"}),e.jsxs(G.Group,{inline:!0,children:[e.jsx(G.Checkbox,{checked:u.PasswordLoginEnabled==="true",label:"允许通过密码进行登录",name:"PasswordLoginEnabled",onChange:N}),h&&e.jsxs(Eu,{open:h,onClose:()=>l(!1),size:"tiny",style:{maxWidth:"450px"},children:[e.jsx(Eu.Header,{children:"警告"}),e.jsx(Eu.Content,{children:e.jsx("p",{children:"取消密码登录将导致所有未绑定其他登录方式的用户（包括管理员）无法通过密码登录，确认取消？"})}),e.jsxs(Eu.Actions,{children:[e.jsx(iu,{onClick:()=>l(!1),children:"取消"}),e.jsx(iu,{color:"yellow",onClick:async()=>{l(!1),await _("PasswordLoginEnabled","false")},children:"确定"})]})]}),e.jsx(G.Checkbox,{checked:u.PasswordRegisterEnabled==="true",label:"允许通过密码进行注册",name:"PasswordRegisterEnabled",onChange:N}),e.jsx(G.Checkbox,{checked:u.EmailVerificationEnabled==="true",label:"通过密码注册时需要进行邮箱验证",name:"EmailVerificationEnabled",onChange:N}),e.jsx(G.Checkbox,{checked:u.GitHubOAuthEnabled==="true",label:"允许通过 GitHub 账户登录 & 注册",name:"GitHubOAuthEnabled",onChange:N}),e.jsx(G.Checkbox,{checked:u.WeChatAuthEnabled==="true",label:"允许通过微信登录 & 注册",name:"WeChatAuthEnabled",onChange:N}),e.jsx(G.Checkbox,{checked:u.TelegramOAuthEnabled==="true",label:"允许通过 Telegram 进行登录",name:"TelegramOAuthEnabled",onChange:N})]}),e.jsxs(G.Group,{inline:!0,children:[e.jsx(G.Checkbox,{checked:u.RegisterEnabled==="true",label:"允许新用户注册（此项为否时，新用户将无法以任何方式进行注册）",name:"RegisterEnabled",onChange:N}),e.jsx(G.Checkbox,{checked:u.TurnstileCheckEnabled==="true",label:"启用 Turnstile 用户校验",name:"TurnstileCheckEnabled",onChange:N})]}),e.jsx(we,{}),e.jsxs(ye,{as:"h3",inverted:k,children:["配置邮箱域名白名单",e.jsx(ye.Subheader,{children:"用以防止恶意用户利用临时邮箱批量注册"})]}),e.jsx(G.Group,{widths:3,children:e.jsx(G.Checkbox,{label:"启用邮箱域名白名单",name:"EmailDomainRestrictionEnabled",onChange:N,checked:u.EmailDomainRestrictionEnabled==="true"})}),e.jsx(G.Group,{widths:3,children:e.jsx(G.Checkbox,{label:"启用邮箱别名限制（例如：ab.cd@gmail.com）",name:"EmailAliasRestrictionEnabled",onChange:N,checked:u.EmailAliasRestrictionEnabled==="true"})}),e.jsxs(G.Group,{widths:2,children:[e.jsx(G.Dropdown,{label:"允许的邮箱域名",placeholder:"允许的邮箱域名",name:"EmailDomainWhitelist",required:!0,fluid:!0,multiple:!0,selection:!0,onChange:N,value:u.EmailDomainWhitelist,autoComplete:"new-password",options:p}),e.jsx(G.Input,{label:"添加新的允许的邮箱域名",action:e.jsx(iu,{type:"button",onClick:()=>{b()},children:"填入"}),onKeyDown:g=>{g.key==="Enter"&&b()},autoComplete:"new-password",placeholder:"输入新的允许的邮箱域名",value:v,onChange:(g,{value:x})=>{F(x)}})]}),e.jsx(G.Button,{onClick:Z,children:"保存邮箱域名白名单设置"}),e.jsx(we,{}),e.jsxs(ye,{as:"h3",inverted:k,children:["配置 SMTP",e.jsx(ye.Subheader,{children:"用以支持系统的邮件发送"})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"SMTP 服务器地址",name:"SMTPServer",onChange:N,autoComplete:"new-password",value:u.SMTPServer,placeholder:"例如：smtp.qq.com"}),e.jsx(G.Input,{label:"SMTP 端口",name:"SMTPPort",onChange:N,autoComplete:"new-password",value:u.SMTPPort,placeholder:"默认: 587"}),e.jsx(G.Input,{label:"SMTP 账户",name:"SMTPAccount",onChange:N,autoComplete:"new-password",value:u.SMTPAccount,placeholder:"通常是邮箱地址"})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"SMTP 发送者邮箱",name:"SMTPFrom",onChange:N,autoComplete:"new-password",value:u.SMTPFrom,placeholder:"通常和邮箱地址保持一致"}),e.jsx(G.Input,{label:"SMTP 访问凭证",name:"SMTPToken",onChange:N,type:"password",autoComplete:"new-password",checked:u.RegisterEnabled==="true",placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(G.Group,{widths:3,children:e.jsx(G.Checkbox,{label:"启用SMTP SSL（465端口强制开启）",name:"SMTPSSLEnabled",onChange:N,checked:u.SMTPSSLEnabled==="true"})}),e.jsx(G.Button,{onClick:W,children:"保存 SMTP 设置"}),e.jsx(we,{}),e.jsxs(ye,{as:"h3",inverted:k,children:["配置 GitHub OAuth App",e.jsxs(ye.Subheader,{children:["用以支持通过 GitHub 进行登录注册，",e.jsx("a",{href:"https://github.com/settings/developers",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 GitHub OAuth App"]})]}),e.jsxs(Pu,{children:["Homepage URL 填 ",e.jsx("code",{children:u.ServerAddress}),"，Authorization callback URL 填"," ",e.jsx("code",{children:`${u.ServerAddress}/oauth/github`})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"GitHub Client ID",name:"GitHubClientId",onChange:N,autoComplete:"new-password",value:u.GitHubClientId,placeholder:"输入你注册的 GitHub OAuth APP 的 ID"}),e.jsx(G.Input,{label:"GitHub Client Secret",name:"GitHubClientSecret",onChange:N,type:"password",autoComplete:"new-password",value:u.GitHubClientSecret,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(G.Button,{onClick:ee,children:"保存 GitHub OAuth 设置"}),e.jsx(we,{}),e.jsxs(ye,{as:"h3",inverted:k,children:["配置 WeChat Server",e.jsxs(ye.Subheader,{children:["用以支持通过微信进行登录注册，",e.jsx("a",{href:"https://github.com/songquanpeng/wechat-server",target:"_blank",rel:"noreferrer",children:"点击此处"}),"了解 WeChat Server"]})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"WeChat Server 服务器地址",name:"WeChatServerAddress",placeholder:"例如：https://yourdomain.com",onChange:N,autoComplete:"new-password",value:u.WeChatServerAddress}),e.jsx(G.Input,{label:"WeChat Server 访问凭证",name:"WeChatServerToken",type:"password",onChange:N,autoComplete:"new-password",value:u.WeChatServerToken,placeholder:"敏感信息不会发送到前端显示"}),e.jsx(G.Input,{label:"微信公众号二维码图片链接",name:"WeChatAccountQRCodeImageURL",onChange:N,autoComplete:"new-password",value:u.WeChatAccountQRCodeImageURL,placeholder:"输入一个图片链接"})]}),e.jsx(G.Button,{onClick:Q,children:"保存 WeChat Server 设置"}),e.jsx(we,{}),e.jsx(ye,{as:"h3",inverted:k,children:"配置 Telegram 登录"}),e.jsxs(G.Group,{inline:!0,children:[e.jsx(G.Input,{label:"Telegram Bot Token",name:"TelegramBotToken",onChange:N,value:u.TelegramBotToken,placeholder:"输入你的 Telegram Bot Token"}),e.jsx(G.Input,{label:"Telegram Bot 名称",name:"TelegramBotName",onChange:N,value:u.TelegramBotName,placeholder:"输入你的 Telegram Bot 名称"})]}),e.jsx(G.Button,{onClick:te,children:"保存 Telegram 登录设置"}),e.jsx(we,{}),e.jsxs(ye,{as:"h3",inverted:k,children:["配置 Turnstile",e.jsxs(ye.Subheader,{children:["用以支持用户校验，",e.jsx("a",{href:"https://dash.cloudflare.com/",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 Turnstile Sites，推荐选择 Invisible Widget Type"]})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"Turnstile Site Key",name:"TurnstileSiteKey",onChange:N,autoComplete:"new-password",value:u.TurnstileSiteKey,placeholder:"输入你注册的 Turnstile Site Key"}),e.jsx(G.Input,{label:"Turnstile Secret Key",name:"TurnstileSecretKey",onChange:N,type:"password",autoComplete:"new-password",value:u.TurnstileSecretKey,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(G.Button,{onClick:K,children:"保存 Turnstile 设置"})]})})})},Pn=()=>{let[u,n]=t.useState({Notice:"",SystemName:"",Logo:"",Footer:"",About:"",HomePageContent:""}),[c,a]=t.useState(!1);t.useState(!1),t.useState({tag_name:"",content:""});const o=async(w,V)=>{a(!0);const H=await M.put("/api/option/",{key:w,value:V}),{success:W,message:Z}=H.data;W?n(Q=>({...Q,[w]:V})):f(Z),a(!1)},[i,p]=t.useState({Notice:!1,SystemName:!1,Logo:!1,HomePageContent:!1,About:!1,Footer:!1}),j=async(w,V)=>{const H=V.target.id;n(W=>({...W,[H]:w}))},v=t.useRef(),F=async()=>{try{p(w=>({...w,Notice:!0})),await o("Notice",u.Notice),Y("公告已更新")}catch(w){console.error("公告更新失败",w),f("公告更新失败")}finally{p(w=>({...w,Notice:!1}))}},h=t.useRef(),l=async()=>{try{p(w=>({...w,SystemName:!0})),await o("SystemName",u.SystemName),Y("系统名称已更新")}catch(w){console.error("系统名称更新失败",w),f("系统名称更新失败")}finally{p(w=>({...w,SystemName:!1}))}},E=async()=>{try{p(w=>({...w,Logo:!0})),await o("Logo",u.Logo),Y("Logo 已更新")}catch(w){console.error("Logo 更新失败",w),f("Logo 更新失败")}finally{p(w=>({...w,Logo:!1}))}},k=async w=>{try{p(V=>({...V,HomePageContent:!0})),await o(w,u[w]),Y("首页内容已更新")}catch(V){console.error("首页内容更新失败",V),f("首页内容更新失败")}finally{p(V=>({...V,HomePageContent:!1}))}},z=async()=>{try{p(w=>({...w,About:!0})),await o("About",u.About),Y("关于内容已更新")}catch(w){console.error("关于内容更新失败",w),f("关于内容更新失败")}finally{p(w=>({...w,About:!1}))}},_=async()=>{try{p(w=>({...w,Footer:!0})),await o("Footer",u.Footer),Y("页脚内容已更新")}catch(w){console.error("页脚内容更新失败",w),f("页脚内容更新失败")}finally{p(w=>({...w,Footer:!1}))}},N=async()=>{const w=await M.get("/api/option/"),{success:V,message:H,data:W}=w.data;if(V){let Z={};W.forEach(Q=>{Q.key in u&&(Z[Q.key]=Q.value)}),n(Z),v.current.setValues(Z),h.current.setValues(Z)}else f(H)};return t.useEffect(()=>{N()},[]),e.jsx(ge,{children:e.jsxs(ce,{span:24,children:[e.jsx(I,{values:u,getFormApi:w=>v.current=w,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"通用设置",children:[e.jsx(I.TextArea,{label:"公告",placeholder:"在此输入新的公告内容，支持 Markdown & HTML 代码",field:"Notice",onChange:j,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(P,{onClick:F,loading:i.Notice,children:"设置公告"})]})}),e.jsx(I,{values:u,getFormApi:w=>h.current=w,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"个性化设置",children:[e.jsx(I.Input,{label:"系统名称",placeholder:"在此输入系统名称",field:"SystemName",onChange:j}),e.jsx(P,{onClick:l,loading:i.SystemName,children:"设置系统名称"}),e.jsx(I.Input,{label:"Logo 图片地址",placeholder:"在此输入 Logo 图片地址",field:"Logo",onChange:j}),e.jsx(P,{onClick:E,loading:i.Logo,children:"设置 Logo"}),e.jsx(I.TextArea,{label:"首页内容",placeholder:"在此输入首页内容，支持 Markdown & HTML 代码，设置后首页的状态信息将不再显示。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为首页。",field:"HomePageContent",onChange:j,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(P,{onClick:()=>k("HomePageContent"),loading:i.HomePageContent,children:"设置首页内容"}),e.jsx(I.TextArea,{label:"关于",placeholder:"在此输入新的关于内容，支持 Markdown & HTML 代码。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为关于页面。",field:"About",onChange:j,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(P,{onClick:z,loading:i.About,children:"设置关于"}),e.jsx(Ke,{fullMode:!1,type:"info",description:"移除 One API 的版权标识必须首先获得授权，项目维护需要花费大量精力，如果本项目对你有意义，请主动支持本项目。",closeIcon:null,style:{marginTop:15}}),e.jsx(I.Input,{label:"页脚",placeholder:"在此输入新的页脚，留空则使用默认页脚，支持 HTML 代码",field:"Footer",onChange:j}),e.jsx(P,{onClick:_,loading:i.Footer,children:"设置页脚"})]})})]})})},$n=()=>{var mu,gu,T,O,ne,re,Fe,Ce,Ne,Xe,xu;const[u,n]=t.useContext(Ze);let c=Oe();const[a,o]=t.useState({wechat_verification_code:"",email_verification_code:"",email:"",self_account_deletion_confirmation:"",set_new_password:"",set_new_password_confirmation:""}),[i,p]=t.useState({}),[j,v]=t.useState(!1),[F,h]=t.useState(!1),[l,E]=t.useState(!1),[k,z]=t.useState(!1),[_,N]=t.useState(!1),[w,V]=t.useState(""),[H,W]=t.useState(""),[Z,Q]=t.useState(!1),[ee,te]=t.useState(!1),[K,b]=t.useState(30),[g,x]=t.useState(""),[R,C]=t.useState(""),[A,s]=t.useState([]),[r,m]=t.useState(!1),[S,d]=t.useState(0);t.useEffect(()=>{let q=localStorage.getItem("status");q&&(q=JSON.parse(q),p(q),q.turnstile_check&&(N(!0),V(q.turnstile_site_key))),J().then(xe=>{console.log(u)}),y().then(),L().then(),d(fu())},[]),t.useEffect(()=>{let q=null;return ee&&K>0?q=setInterval(()=>{b(K-1)},1e3):K===0&&(te(!1),b(30)),()=>clearInterval(q)},[ee,K]);const D=(q,xe)=>{o(Ee=>({...Ee,[q]:xe}))},B=async()=>{const q=await M.get("/api/user/token"),{success:xe,message:Ee,data:We}=q.data;xe?(C(We),await Re(We),Y("令牌已重置并已复制到剪贴板")):f(Ee)},L=async()=>{const q=await M.get("/api/user/aff"),{success:xe,message:Ee,data:We}=q.data;if(xe){let bt=`${window.location.origin}/register?aff=${We}`;x(bt)}else f(Ee)},J=async()=>{let q=await M.get("/api/user/self");const{success:xe,message:Ee,data:We}=q.data;xe?n({type:"login",payload:We}):f(Ee)},y=async()=>{let q=await M.get("/api/user/models");const{success:xe,message:Ee,data:We}=q.data;xe?(s(We),console.log(We)):f(Ee)},U=async q=>{q.target.select(),await Re(q.target.value),Y("邀请链接已复制到剪切板")},ue=async q=>{q.target.select(),await Re(q.target.value),Y("系统令牌已复制到剪切板")},ie=async()=>{if(a.self_account_deletion_confirmation!==u.user.username){f("请输入你的账户名以确认删除！");return}const q=await M.delete("/api/user/self"),{success:xe,message:Ee}=q.data;xe?(Y("账户已删除！"),await M.get("/api/user/logout"),n({type:"logout"}),localStorage.removeItem("user"),c("/login")):f(Ee)},le=async()=>{if(a.wechat_verification_code==="")return;const q=await M.get(`/api/oauth/wechat/bind?code=${a.wechat_verification_code}`),{success:xe,message:Ee}=q.data;xe?(Y("微信账户绑定成功！"),h(!1)):f(Ee)},oe=async()=>{if(a.set_new_password!==a.set_new_password_confirmation){f("两次输入的密码不一致！");return}const q=await M.put("/api/user/self",{password:a.set_new_password}),{success:xe,message:Ee}=q.data;xe?(Y("密码修改成功！"),h(!1)):f(Ee),v(!1)},be=async()=>{if(S<fu()){f("划转金额最低为"+me(fu()));return}const q=await M.post("/api/user/aff_transfer",{quota:S}),{success:xe,message:Ee}=q.data;xe?(Y(Ee),m(!1),J().then()):f(Ee)},Pe=async()=>{if(a.email===""){f("请输入邮箱！");return}if(te(!0),_&&H===""){Ae("请稍后几秒重试，Turnstile 正在检查用户环境！");return}Q(!0);const q=await M.get(`/api/verification?email=${a.email}&turnstile=${H}`),{success:xe,message:Ee}=q.data;xe?Y("验证码发送成功，请检查邮箱！"):f(Ee),Q(!1)},ze=async()=>{if(a.email_verification_code===""){f("请输入邮箱验证码！");return}Q(!0);const q=await M.get(`/api/oauth/email/bind?email=${a.email}&code=${a.email_verification_code}`),{success:xe,message:Ee}=q.data;xe?(Y("邮箱账户绑定成功！"),E(!1),u.user.email=a.email):f(Ee),Q(!1)},Le=()=>u.user?u.user.username:"null",tu=()=>{m(!1)},bu=async q=>{await Re(q)?Y("已复制："+q):fe.error({title:"无法复制到剪贴板，请手动复制",content:q})};return e.jsx("div",{children:e.jsx(ae,{children:e.jsxs(ae.Content,{children:[e.jsxs(fe,{title:"请输入要划转的数量",visible:r,onOk:be,onCancel:tu,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("div",{style:{marginTop:20},children:[e.jsx(X.Text,{children:`可用额度${cu((mu=u==null?void 0:u.user)==null?void 0:mu.aff_quota)}`}),e.jsx(se,{style:{marginTop:5},value:(gu=u==null?void 0:u.user)==null?void 0:gu.aff_quota,disabled:!0})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(X.Text,{children:`划转额度${cu(S)} 最低`+me(fu())}),e.jsx("div",{children:e.jsx(ku,{min:0,style:{marginTop:5},value:S,onChange:q=>d(q),disabled:!1})})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsxs(Be,{title:e.jsx(Be.Meta,{avatar:e.jsx(Ou,{size:"default",color:du(Le()),style:{marginRight:4},children:typeof Le()=="string"&&Le().slice(0,1)}),title:e.jsx(X.Text,{children:Le()}),description:pt()?e.jsx($,{color:"red",children:"管理员"}):e.jsx($,{color:"blue",children:"普通用户"})}),headerExtraContent:e.jsx(e.Fragment,{children:e.jsxs(he,{vertical:!0,align:"start",children:[e.jsx($,{color:"green",children:"ID: "+((T=u==null?void 0:u.user)==null?void 0:T.id)}),e.jsx($,{color:"blue",children:(O=u==null?void 0:u.user)==null?void 0:O.group})]})}),footer:e.jsxs(He,{row:!0,children:[e.jsx(He.Item,{itemKey:"当前余额",children:me((ne=u==null?void 0:u.user)==null?void 0:ne.quota)}),e.jsx(He.Item,{itemKey:"历史消耗",children:me((re=u==null?void 0:u.user)==null?void 0:re.used_quota)}),e.jsx(He.Item,{itemKey:"请求次数",children:(Fe=u.user)==null?void 0:Fe.request_count})]}),children:[e.jsx(X.Title,{heading:6,children:"可用模型"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(he,{wrap:!0,children:A.map(q=>e.jsx($,{color:"cyan",onClick:()=>{bu(q)},children:q},q))})})]}),e.jsxs(Be,{footer:e.jsxs("div",{children:[e.jsx(X.Text,{children:"邀请链接"}),e.jsx(se,{style:{marginTop:10},value:g,onClick:U,readOnly:!0})]}),children:[e.jsx(X.Title,{heading:6,children:"邀请信息"}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(He,{row:!0,children:[e.jsxs(He.Item,{itemKey:"待使用收益",children:[e.jsx("span",{style:{color:"rgba(var(--semi-red-5), 1)"},children:me((Ce=u==null?void 0:u.user)==null?void 0:Ce.aff_quota)}),e.jsx(P,{type:"secondary",onClick:()=>m(!0),size:"small",style:{marginLeft:10},children:"划转"})]}),e.jsx(He.Item,{itemKey:"总收益",children:me((Ne=u==null?void 0:u.user)==null?void 0:Ne.aff_history_quota)}),e.jsx(He.Item,{itemKey:"邀请人数",children:(Xe=u==null?void 0:u.user)==null?void 0:Xe.aff_count})]})})]}),e.jsxs(Be,{children:[e.jsx(X.Title,{heading:6,children:"个人信息"}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(X.Text,{strong:!0,children:"邮箱"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.email!==""?u.user.email:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(P,{onClick:()=>{E(!0)},children:u.user&&u.user.email!==""?"修改绑定":"绑定邮箱"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(X.Text,{strong:!0,children:"微信"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.wechat_id!==""?"已绑定":"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(P,{disabled:u.user&&u.user.wechat_id!==""||!i.wechat_login,children:i.wechat_login?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(X.Text,{strong:!0,children:"GitHub"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.github_id!==""?u.user.github_id:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(P,{onClick:()=>{Ct(i.github_client_id)},disabled:u.user&&u.user.github_id!==""||!i.github_oauth,children:i.github_oauth?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(X.Text,{strong:!0,children:"Telegram"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.telegram_id!==""?u.user.telegram_id:"未绑定",readonly:!0})}),e.jsx("div",{children:i.telegram_oauth?u.user.telegram_id!==""?e.jsx(P,{disabled:!0,children:"已绑定"}):e.jsx(ht,{dataAuthUrl:"/api/oauth/telegram/bind",botName:i.telegram_bot_name}):e.jsx(P,{disabled:!0,children:"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(he,{children:[e.jsx(P,{onClick:B,children:"生成系统访问令牌"}),e.jsx(P,{onClick:()=>{v(!0)},children:"修改密码"}),e.jsx(P,{type:"danger",onClick:()=>{z(!0)},children:"删除个人账户"})]}),R&&e.jsx(se,{readOnly:!0,value:R,onClick:ue,style:{marginTop:"10px"}}),i.wechat_login&&e.jsx(P,{onClick:()=>{h(!0)},children:"绑定微信账号"}),e.jsxs(fe,{onCancel:()=>h(!1),visible:F,size:"small",children:[e.jsx(wt,{src:i.wechat_qrcode}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(se,{placeholder:"验证码",name:"wechat_verification_code",value:a.wechat_verification_code,onChange:q=>D("wechat_verification_code",q)}),e.jsx(P,{color:"",fluid:!0,size:"large",onClick:le,children:"绑定"})]})]})]}),e.jsxs(fe,{onCancel:()=>E(!1),onOk:ze,visible:l,size:"small",centered:!0,maskClosable:!1,children:[e.jsx(X.Title,{heading:6,children:"绑定邮箱地址"}),e.jsxs("div",{style:{marginTop:20,display:"flex",justifyContent:"space-between"},children:[e.jsx(se,{fluid:!0,placeholder:"输入邮箱地址",onChange:q=>D("email",q),name:"email",type:"email"}),e.jsx(P,{onClick:Pe,disabled:ee||Z,children:ee?`重新发送 (${K})`:"获取验证码"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(se,{fluid:!0,placeholder:"验证码",name:"email_verification_code",value:a.email_verification_code,onChange:q=>D("email_verification_code",q)})}),_?e.jsx(au,{sitekey:w,onVerify:q=>{W(q)}}):e.jsx(e.Fragment,{})]}),e.jsxs(fe,{onCancel:()=>z(!1),visible:k,size:"small",centered:!0,onOk:ie,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Ke,{type:"danger",description:"您正在删除自己的帐户，将清空所有数据且不可恢复",closeIcon:null})}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(se,{placeholder:`输入你的账户名 ${(xu=u==null?void 0:u.user)==null?void 0:xu.username} 以确认删除`,name:"self_account_deletion_confirmation",value:a.self_account_deletion_confirmation,onChange:q=>D("self_account_deletion_confirmation",q)}),_?e.jsx(au,{sitekey:w,onVerify:q=>{W(q)}}):e.jsx(e.Fragment,{})]})]}),e.jsx(fe,{onCancel:()=>v(!1),visible:j,size:"small",centered:!0,onOk:oe,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx(se,{name:"set_new_password",placeholder:"新密码",value:a.set_new_password,onChange:q=>D("set_new_password",q)}),e.jsx(se,{style:{marginTop:20},name:"set_new_password_confirmation",placeholder:"确认新密码",value:a.set_new_password_confirmation,onChange:q=>D("set_new_password_confirmation",q)}),_?e.jsx(au,{sitekey:w,onVerify:q=>{W(q)}}):e.jsx(e.Fragment,{})]})})]})]})})})};function Mn(u){const[n,c]=t.useState(!1),[a,o]=t.useState({TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:"",RetryTimes:"",DisplayInCurrencyEnabled:!1,DisplayTokenStatEnabled:!1,DefaultCollapseSidebar:!1}),i=t.useRef(),[p,j]=t.useState(a);function v(h,l){const E=l.target.id;o(k=>({...k,[E]:h}))}function F(){const h=Ye(a,p);if(!h.length)return Je("你似乎并没有修改什么");const l=h.map(E=>{let k="";return typeof a[E.key]=="boolean"?k=String(a[E.key]):k=a[E.key],M.put("/api/option/",{key:E.key,value:k})});c(!0),Promise.all(l).then(E=>{if(l.length===1){if(E.includes(void 0))return}else if(l.length>1&&E.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const h={};for(let l in u.options)Object.keys(a).includes(l)&&(h[l]=u.options[l]);o(h),j(structuredClone(h)),i.current.setValues(h)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(I,{values:a,getFormApi:h=>i.current=h,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"通用设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(I.Input,{field:"TopUpLink",label:"充值链接",initValue:"",placeholder:"例如发卡网站的购买链接",onChange:v,showClear:!0})}),e.jsx(ce,{span:8,children:e.jsx(I.Input,{field:"ChatLink",label:"默认聊天页面链接",initValue:"",placeholder:"例如 ChatGPT Next Web 的部署地址",onChange:v,showClear:!0})}),e.jsx(ce,{span:8,children:e.jsx(I.Input,{field:"ChatLink2",label:"聊天页面 2 链接",initValue:"",placeholder:"例如 ChatGPT Next Web 的部署地址",onChange:v,showClear:!0})}),e.jsx(ce,{span:8,children:e.jsx(I.Input,{field:"QuotaPerUnit",label:"单位美元额度",initValue:"",placeholder:"一单位货币能兑换的额度",onChange:v,showClear:!0})}),e.jsx(ce,{span:8,children:e.jsx(I.Input,{field:"RetryTimes",label:"失败重试次数",initValue:"",placeholder:"失败重试次数",onChange:v,showClear:!0})})]}),e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"DisplayInCurrencyEnabled",label:"以货币形式显示额度",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:h=>{o({...a,DisplayInCurrencyEnabled:h})}})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"DisplayTokenStatEnabled",label:"Billing 相关 API 显示令牌额度而非用户额度",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:h=>o({...a,DisplayTokenStatEnabled:h})})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"DefaultCollapseSidebar",label:"默认折叠侧边栏",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:h=>o({...a,DefaultCollapseSidebar:h})})})]}),e.jsx(ge,{children:e.jsx(P,{size:"large",onClick:F,children:"保存通用设置"})})]})})})})}function Rn(u){const[n,c]=t.useState(!1),[a,o]=t.useState({DrawingEnabled:!1,MjNotifyEnabled:!1,MjAccountFilterEnabled:!1,MjForwardUrlEnabled:!1,MjModeClearEnabled:!1,MjActionCheckSuccessEnabled:!1}),i=t.useRef(),[p,j]=t.useState(a);function v(){const F=Ye(a,p);if(!F.length)return Je("你似乎并没有修改什么");const h=F.map(l=>{let E="";return typeof a[l.key]=="boolean"?E=String(a[l.key]):E=a[l.key],M.put("/api/option/",{key:l.key,value:E})});c(!0),Promise.all(h).then(l=>{if(h.length===1){if(l.includes(void 0))return}else if(h.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const F={};for(let h in u.options)Object.keys(a).includes(h)&&(F[h]=u.options[h]);o(F),j(structuredClone(F)),i.current.setValues(F),localStorage.setItem("mj_notify_enabled",String(a.MjNotifyEnabled))},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(I,{values:a,getFormApi:F=>i.current=F,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"绘图设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"DrawingEnabled",label:"启用绘图功能",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>{o({...a,DrawingEnabled:F})}})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"MjNotifyEnabled",label:"允许回调（会泄露服务器 IP 地址）",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>o({...a,MjNotifyEnabled:F})})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"MjAccountFilterEnabled",label:"允许 AccountFilter 参数",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>o({...a,MjAccountFilterEnabled:F})})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"MjForwardUrlEnabled",label:"开启之后将上游地址替换为服务器地址",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>o({...a,MjForwardUrlEnabled:F})})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"MjModeClearEnabled",label:e.jsxs(e.Fragment,{children:["开启之后会清除用户提示词中的 ",e.jsx($,{children:"--fast"})," 、",e.jsx($,{children:"--relax"})," 以及 ",e.jsx($,{children:"--turbo"})," 参数"]}),size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>o({...a,MjModeClearEnabled:F})})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"MjActionCheckSuccessEnabled",label:e.jsx(e.Fragment,{children:"检测必须等待绘图成功才能进行放大等操作"}),size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>o({...a,MjActionCheckSuccessEnabled:F})})})]}),e.jsx(ge,{children:e.jsx(P,{size:"large",onClick:v,children:"保存绘图设置"})})]})})})})}function On(u){const[n,c]=t.useState(!1),[a,o]=t.useState({CheckSensitiveEnabled:!1,CheckSensitiveOnPromptEnabled:!1,SensitiveWords:""}),i=t.useRef(),[p,j]=t.useState(a);function v(){const F=Ye(a,p);if(!F.length)return Je("你似乎并没有修改什么");const h=F.map(l=>{let E="";return typeof a[l.key]=="boolean"?E=String(a[l.key]):E=a[l.key],M.put("/api/option/",{key:l.key,value:E})});c(!0),Promise.all(h).then(l=>{if(h.length===1){if(l.includes(void 0))return}else if(h.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const F={};for(let h in u.options)Object.keys(a).includes(h)&&(F[h]=u.options[h]);o(F),j(structuredClone(F)),i.current.setValues(F)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(I,{values:a,getFormApi:F=>i.current=F,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"屏蔽词过滤设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"CheckSensitiveEnabled",label:"启用屏蔽词过滤功能",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>{o({...a,CheckSensitiveEnabled:F})}})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"CheckSensitiveOnPromptEnabled",label:"启用 Prompt 检查",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>o({...a,CheckSensitiveOnPromptEnabled:F})})})]}),e.jsx(ge,{children:e.jsx(ce,{span:16,children:e.jsx(I.TextArea,{label:"屏蔽词列表",extraText:"一行一个屏蔽词，不需要符号分割",placeholder:"一行一个屏蔽词，不需要符号分割",field:"SensitiveWords",onChange:F=>o({...a,SensitiveWords:F}),style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}})})}),e.jsx(ge,{children:e.jsx(P,{size:"large",onClick:v,children:"保存屏蔽词过滤设置"})})]})})})})}var Dt={exports:{}};(function(u,n){(function(c,a){u.exports=a()})(qt,function(){var c=1e3,a=6e4,o=36e5,i="millisecond",p="second",j="minute",v="hour",F="day",h="week",l="month",E="quarter",k="year",z="date",_="Invalid Date",N=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,w=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,V={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(C){var A=["th","st","nd","rd"],s=C%100;return"["+C+(A[(s-20)%10]||A[s]||A[0])+"]"}},H=function(C,A,s){var r=String(C);return!r||r.length>=A?C:""+Array(A+1-r.length).join(s)+C},W={s:H,z:function(C){var A=-C.utcOffset(),s=Math.abs(A),r=Math.floor(s/60),m=s%60;return(A<=0?"+":"-")+H(r,2,"0")+":"+H(m,2,"0")},m:function C(A,s){if(A.date()<s.date())return-C(s,A);var r=12*(s.year()-A.year())+(s.month()-A.month()),m=A.clone().add(r,l),S=s-m<0,d=A.clone().add(r+(S?-1:1),l);return+(-(r+(s-m)/(S?m-d:d-m))||0)},a:function(C){return C<0?Math.ceil(C)||0:Math.floor(C)},p:function(C){return{M:l,y:k,w:h,d:F,D:z,h:v,m:j,s:p,ms:i,Q:E}[C]||String(C||"").toLowerCase().replace(/s$/,"")},u:function(C){return C===void 0}},Z="en",Q={};Q[Z]=V;var ee="$isDayjsObject",te=function(C){return C instanceof x||!(!C||!C[ee])},K=function C(A,s,r){var m;if(!A)return Z;if(typeof A=="string"){var S=A.toLowerCase();Q[S]&&(m=S),s&&(Q[S]=s,m=S);var d=A.split("-");if(!m&&d.length>1)return C(d[0])}else{var D=A.name;Q[D]=A,m=D}return!r&&m&&(Z=m),m||!r&&Z},b=function(C,A){if(te(C))return C.clone();var s=typeof A=="object"?A:{};return s.date=C,s.args=arguments,new x(s)},g=W;g.l=K,g.i=te,g.w=function(C,A){return b(C,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var x=function(){function C(s){this.$L=K(s.locale,null,!0),this.parse(s),this.$x=this.$x||s.x||{},this[ee]=!0}var A=C.prototype;return A.parse=function(s){this.$d=function(r){var m=r.date,S=r.utc;if(m===null)return new Date(NaN);if(g.u(m))return new Date;if(m instanceof Date)return new Date(m);if(typeof m=="string"&&!/Z$/i.test(m)){var d=m.match(N);if(d){var D=d[2]-1||0,B=(d[7]||"0").substring(0,3);return S?new Date(Date.UTC(d[1],D,d[3]||1,d[4]||0,d[5]||0,d[6]||0,B)):new Date(d[1],D,d[3]||1,d[4]||0,d[5]||0,d[6]||0,B)}}return new Date(m)}(s),this.init()},A.init=function(){var s=this.$d;this.$y=s.getFullYear(),this.$M=s.getMonth(),this.$D=s.getDate(),this.$W=s.getDay(),this.$H=s.getHours(),this.$m=s.getMinutes(),this.$s=s.getSeconds(),this.$ms=s.getMilliseconds()},A.$utils=function(){return g},A.isValid=function(){return this.$d.toString()!==_},A.isSame=function(s,r){var m=b(s);return this.startOf(r)<=m&&m<=this.endOf(r)},A.isAfter=function(s,r){return b(s)<this.startOf(r)},A.isBefore=function(s,r){return this.endOf(r)<b(s)},A.$g=function(s,r,m){return g.u(s)?this[r]:this.set(m,s)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(s,r){var m=this,S=!!g.u(r)||r,d=g.p(s),D=function(le,oe){var be=g.w(m.$u?Date.UTC(m.$y,oe,le):new Date(m.$y,oe,le),m);return S?be:be.endOf(F)},B=function(le,oe){return g.w(m.toDate()[le].apply(m.toDate("s"),(S?[0,0,0,0]:[23,59,59,999]).slice(oe)),m)},L=this.$W,J=this.$M,y=this.$D,U="set"+(this.$u?"UTC":"");switch(d){case k:return S?D(1,0):D(31,11);case l:return S?D(1,J):D(0,J+1);case h:var ue=this.$locale().weekStart||0,ie=(L<ue?L+7:L)-ue;return D(S?y-ie:y+(6-ie),J);case F:case z:return B(U+"Hours",0);case v:return B(U+"Minutes",1);case j:return B(U+"Seconds",2);case p:return B(U+"Milliseconds",3);default:return this.clone()}},A.endOf=function(s){return this.startOf(s,!1)},A.$set=function(s,r){var m,S=g.p(s),d="set"+(this.$u?"UTC":""),D=(m={},m[F]=d+"Date",m[z]=d+"Date",m[l]=d+"Month",m[k]=d+"FullYear",m[v]=d+"Hours",m[j]=d+"Minutes",m[p]=d+"Seconds",m[i]=d+"Milliseconds",m)[S],B=S===F?this.$D+(r-this.$W):r;if(S===l||S===k){var L=this.clone().set(z,1);L.$d[D](B),L.init(),this.$d=L.set(z,Math.min(this.$D,L.daysInMonth())).$d}else D&&this.$d[D](B);return this.init(),this},A.set=function(s,r){return this.clone().$set(s,r)},A.get=function(s){return this[g.p(s)]()},A.add=function(s,r){var m,S=this;s=Number(s);var d=g.p(r),D=function(J){var y=b(S);return g.w(y.date(y.date()+Math.round(J*s)),S)};if(d===l)return this.set(l,this.$M+s);if(d===k)return this.set(k,this.$y+s);if(d===F)return D(1);if(d===h)return D(7);var B=(m={},m[j]=a,m[v]=o,m[p]=c,m)[d]||1,L=this.$d.getTime()+s*B;return g.w(L,this)},A.subtract=function(s,r){return this.add(-1*s,r)},A.format=function(s){var r=this,m=this.$locale();if(!this.isValid())return m.invalidDate||_;var S=s||"YYYY-MM-DDTHH:mm:ssZ",d=g.z(this),D=this.$H,B=this.$m,L=this.$M,J=m.weekdays,y=m.months,U=m.meridiem,ue=function(oe,be,Pe,ze){return oe&&(oe[be]||oe(r,S))||Pe[be].slice(0,ze)},ie=function(oe){return g.s(D%12||12,oe,"0")},le=U||function(oe,be,Pe){var ze=oe<12?"AM":"PM";return Pe?ze.toLowerCase():ze};return S.replace(w,function(oe,be){return be||function(Pe){switch(Pe){case"YY":return String(r.$y).slice(-2);case"YYYY":return g.s(r.$y,4,"0");case"M":return L+1;case"MM":return g.s(L+1,2,"0");case"MMM":return ue(m.monthsShort,L,y,3);case"MMMM":return ue(y,L);case"D":return r.$D;case"DD":return g.s(r.$D,2,"0");case"d":return String(r.$W);case"dd":return ue(m.weekdaysMin,r.$W,J,2);case"ddd":return ue(m.weekdaysShort,r.$W,J,3);case"dddd":return J[r.$W];case"H":return String(D);case"HH":return g.s(D,2,"0");case"h":return ie(1);case"hh":return ie(2);case"a":return le(D,B,!0);case"A":return le(D,B,!1);case"m":return String(B);case"mm":return g.s(B,2,"0");case"s":return String(r.$s);case"ss":return g.s(r.$s,2,"0");case"SSS":return g.s(r.$ms,3,"0");case"Z":return d}return null}(oe)||d.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(s,r,m){var S,d=this,D=g.p(r),B=b(s),L=(B.utcOffset()-this.utcOffset())*a,J=this-B,y=function(){return g.m(d,B)};switch(D){case k:S=y()/12;break;case l:S=y();break;case E:S=y()/3;break;case h:S=(J-L)/6048e5;break;case F:S=(J-L)/864e5;break;case v:S=J/o;break;case j:S=J/a;break;case p:S=J/c;break;default:S=J}return m?S:g.a(S)},A.daysInMonth=function(){return this.endOf(l).$D},A.$locale=function(){return Q[this.$L]},A.locale=function(s,r){if(!s)return this.$L;var m=this.clone(),S=K(s,r,!0);return S&&(m.$L=S),m},A.clone=function(){return g.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},C}(),R=x.prototype;return b.prototype=R,[["$ms",i],["$s",p],["$m",j],["$H",v],["$W",F],["$M",l],["$y",k],["$D",z]].forEach(function(C){R[C[1]]=function(A){return this.$g(A,C[0],C[1])}}),b.extend=function(C,A){return C.$i||(C(A,x,b),C.$i=!0),b},b.locale=K,b.isDayjs=te,b.unix=function(C){return b(1e3*C)},b.en=Q[Z],b.Ls=Q,b.p={},b})})(Dt);var zn=Dt.exports;const Ln=Vt(zn);function Nn(u){const[n,c]=t.useState(!1),[a,o]=t.useState(!1),[i,p]=t.useState({LogConsumeEnabled:!1,historyTimestamp:Ln().subtract(1,"month").toDate()}),j=t.useRef(),[v,F]=t.useState(i);function h(){const E=Ye(i,v).filter(z=>z.key!=="historyTimestamp");if(!E.length)return Je("你似乎并没有修改什么");const k=E.map(z=>{let _="";return typeof i[z.key]=="boolean"?_=String(i[z.key]):_=i[z.key],M.put("/api/option/",{key:z.key,value:_})});c(!0),Promise.all(k).then(z=>{if(k.length===1){if(z.includes(void 0))return}else if(k.length>1&&z.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}async function l(){try{if(o(!0),!i.historyTimestamp)throw new Error("请选择日志记录时间");const E=await M.delete(`/api/log/?target_timestamp=${Date.parse(i.historyTimestamp)/1e3}`),{success:k,message:z,data:_}=E.data;if(k){Y(`${_} 条日志已清理！`);return}else throw new Error("日志清理失败："+z)}catch(E){f(E.message)}finally{o(!1)}}return t.useEffect(()=>{const E={};for(let k in u.options)Object.keys(i).includes(k)&&(E[k]=u.options[k]);E.historyTimestamp=i.historyTimestamp,p(Object.assign(i,E)),F(structuredClone(E)),j.current.setValues(E)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(I,{values:i,getFormApi:E=>j.current=E,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"日志设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"LogConsumeEnabled",label:"启用额度消费日志记录",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:E=>{p({...i,LogConsumeEnabled:E})}})}),e.jsx(ce,{span:8,children:e.jsxs(De,{spinning:a,children:[e.jsx(I.DatePicker,{label:"日志记录时间",field:"historyTimestamp",type:"dateTime",inputReadOnly:!0,onChange:E=>{p({...i,historyTimestamp:E})}}),e.jsx(P,{size:"default",onClick:l,children:"清除历史日志"})]})})]}),e.jsx(ge,{children:e.jsx(P,{size:"large",onClick:h,children:"保存日志设置"})})]})})})})}function Un(u){const n=[{key:"hour",label:"小时",value:"hour"},{key:"day",label:"天",value:"day"},{key:"week",label:"周",value:"week"}],[c,a]=t.useState(!1),[o,i]=t.useState({DataExportEnabled:!1,DataExportInterval:"",DataExportDefaultTime:""}),p=t.useRef(),[j,v]=t.useState(o);function F(){const h=Ye(o,j);if(!h.length)return Je("你似乎并没有修改什么");const l=h.map(E=>{let k="";return typeof o[E.key]=="boolean"?k=String(o[E.key]):k=o[E.key],M.put("/api/option/",{key:E.key,value:k})});a(!0),Promise.all(l).then(E=>{if(l.length===1){if(E.includes(void 0))return}else if(l.length>1&&E.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{a(!1)})}return t.useEffect(()=>{const h={};for(let l in u.options)Object.keys(o).includes(l)&&(h[l]=u.options[l]);i(h),v(structuredClone(h)),p.current.setValues(h),localStorage.setItem("data_export_default_time",String(o.DataExportDefaultTime))},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:c,children:e.jsx(I,{values:o,getFormApi:h=>p.current=h,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"数据看板设置",children:[e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"DataExportEnabled",label:"启用数据看板（实验性）",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:h=>{i({...o,DataExportEnabled:h})}})})}),e.jsxs(ge,{children:[e.jsx(ce,{span:8,children:e.jsx(I.InputNumber,{label:"数据看板更新间隔 ",step:1,min:1,suffix:"分钟",extraText:"设置过短会影响数据库性能",placeholder:"数据看板更新间隔",field:"DataExportInterval",onChange:h=>i({...o,DataExportInterval:String(h)})})}),e.jsx(ce,{span:8,children:e.jsx(I.Select,{label:"数据看板默认时间粒度",optionList:n,field:"DataExportDefaultTime",extraText:"仅修改展示粒度，统计精确到小时",placeholder:"数据看板默认时间粒度",style:{width:180},onChange:h=>i({...o,DataExportDefaultTime:String(h)})})})]}),e.jsx(ge,{children:e.jsx(P,{size:"large",onClick:F,children:"保存数据看板设置"})})]})})})})}function Wn(u){const[n,c]=t.useState(!1),[a,o]=t.useState({ChannelDisableThreshold:"",QuotaRemindThreshold:"",AutomaticDisableChannelEnabled:!1,AutomaticEnableChannelEnabled:!1}),i=t.useRef(),[p,j]=t.useState(a);function v(){const F=Ye(a,p);if(!F.length)return Je("你似乎并没有修改什么");const h=F.map(l=>{let E="";return typeof a[l.key]=="boolean"?E=String(a[l.key]):E=a[l.key],M.put("/api/option/",{key:l.key,value:E})});c(!0),Promise.all(h).then(l=>{if(h.length===1){if(l.includes(void 0))return}else if(h.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const F={};for(let h in u.options)Object.keys(a).includes(h)&&(F[h]=u.options[h]);o(F),j(structuredClone(F)),i.current.setValues(F)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(I,{values:a,getFormApi:F=>i.current=F,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"监控设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(I.InputNumber,{label:"最长响应时间",step:1,min:0,suffix:"秒",extraText:"当运行通道全部测试时，超过此时间将自动禁用通道",placeholder:"",field:"ChannelDisableThreshold",onChange:F=>o({...a,ChannelDisableThreshold:String(F)})})}),e.jsx(ce,{span:8,children:e.jsx(I.InputNumber,{label:"额度提醒阈值",step:1,min:0,suffix:"Token",extraText:"低于此额度时将发送邮件提醒用户",placeholder:"",field:"QuotaRemindThreshold",onChange:F=>o({...a,QuotaRemindThreshold:String(F)})})})]}),e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"AutomaticDisableChannelEnabled",label:"失败时自动禁用通道",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>{o({...a,AutomaticDisableChannelEnabled:F})}})}),e.jsx(ce,{span:8,children:e.jsx(I.Switch,{field:"AutomaticEnableChannelEnabled",label:"成功时自动启用通道",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>o({...a,AutomaticEnableChannelEnabled:F})})})]}),e.jsx(ge,{children:e.jsx(P,{size:"large",onClick:v,children:"保存监控设置"})})]})})})})}function Kn(u){const[n,c]=t.useState(!1),[a,o]=t.useState({QuotaForNewUser:"",PreConsumedQuota:"",QuotaForInviter:"",QuotaForInvitee:""}),i=t.useRef(),[p,j]=t.useState(a);function v(){const F=Ye(a,p);if(!F.length)return Je("你似乎并没有修改什么");const h=F.map(l=>{let E="";return typeof a[l.key]=="boolean"?E=String(a[l.key]):E=a[l.key],M.put("/api/option/",{key:l.key,value:E})});c(!0),Promise.all(h).then(l=>{if(h.length===1){if(l.includes(void 0))return}else if(h.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const F={};for(let h in u.options)Object.keys(a).includes(h)&&(F[h]=u.options[h]);o(F),j(structuredClone(F)),i.current.setValues(F)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(I,{values:a,getFormApi:F=>i.current=F,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"额度设置",children:[e.jsxs(ge,{gutter:16,children:[e.jsx(ce,{span:6,children:e.jsx(I.InputNumber,{label:"新用户初始额度",field:"QuotaForNewUser",step:1,min:0,suffix:"Token",placeholder:"",onChange:F=>o({...a,QuotaForNewUser:String(F)})})}),e.jsx(ce,{span:6,children:e.jsx(I.InputNumber,{label:"请求预扣费额度",field:"PreConsumedQuota",step:1,min:0,suffix:"Token",extraText:"请求结束后多退少补",placeholder:"",onChange:F=>o({...a,PreConsumedQuota:String(F)})})}),e.jsx(ce,{span:6,children:e.jsx(I.InputNumber,{label:"邀请新用户奖励额度",field:"QuotaForInviter",step:1,min:0,suffix:"Token",extraText:"",placeholder:"例如：2000",onChange:F=>o({...a,QuotaForInviter:String(F)})})}),e.jsx(ce,{span:6,children:e.jsx(I.InputNumber,{label:"新用户使用邀请码奖励额度",field:"QuotaForInvitee",step:1,min:0,suffix:"Token",extraText:"",placeholder:"例如：1000",onChange:F=>o({...a,QuotaForInvitee:String(F)})})})]}),e.jsx(ge,{children:e.jsx(P,{size:"large",onClick:v,children:"保存额度设置"})})]})})})})}function Hn(u){const[n,c]=t.useState(!1),[a,o]=t.useState({ModelPrice:"",ModelRatio:"",CompletionRatio:"",GroupRatio:""}),i=t.useRef(),[p,j]=t.useState(a);async function v(){try{console.log("Starting validation..."),await i.current.validate().then(()=>{console.log("Validation passed");const h=Ye(a,p);if(!h.length)return Je("你似乎并没有修改什么");const l=h.map(E=>{let k="";return typeof a[E.key]=="boolean"?k=String(a[E.key]):k=a[E.key],M.put("/api/option/",{key:E.key,value:k})});c(!0),Promise.all(l).then(E=>{if(l.length===1){if(E.includes(void 0))return}else if(l.length>1&&E.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}).catch(h=>{console.error("Validation failed:",h),f("请检查输入")})}catch(h){f("请检查输入"),console.error(h)}}async function F(){try{let h=await M.post("/api/option/rest_model_ratio");h.data.success?(Y(h.data.message),u.refresh()):f(h.data.message)}catch(h){f(h)}}return t.useEffect(()=>{const h={};for(let l in u.options)Object.keys(a).includes(l)&&(h[l]=u.options[l]);o(h),j(structuredClone(h)),i.current.setValues(h)},[u.options]),e.jsxs(De,{spinning:n,children:[e.jsx(I,{values:a,getFormApi:h=>i.current=h,style:{marginBottom:15},children:e.jsxs(I.Section,{text:"倍率设置",children:[e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:16,children:e.jsx(I.TextArea,{label:"模型固定价格",extraText:"一次调用消耗多少刀，优先级大于模型倍率",placeholder:'为一个 JSON 文本，键为模型名称，值为一次调用消耗多少刀，比如 "gpt-4-gizmo-*": 0.1，一次消耗0.1刀',field:"ModelPrice",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(h,l)=>su(l),message:"不是合法的 JSON 字符串"}],onChange:h=>o({...a,ModelPrice:h})})})}),e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:16,children:e.jsx(I.TextArea,{label:"模型倍率",extraText:"",placeholder:"为一个 JSON 文本，键为模型名称，值为倍率",field:"ModelRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(h,l)=>su(l),message:"不是合法的 JSON 字符串"}],onChange:h=>o({...a,ModelRatio:h})})})}),e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:16,children:e.jsx(I.TextArea,{label:"模型补全倍率（仅对自定义模型有效）",extraText:"仅对自定义模型有效",placeholder:"为一个 JSON 文本，键为模型名称，值为倍率",field:"CompletionRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(h,l)=>su(l),message:"不是合法的 JSON 字符串"}],onChange:h=>o({...a,CompletionRatio:h})})})}),e.jsx(ge,{gutter:16,children:e.jsx(ce,{span:16,children:e.jsx(I.TextArea,{label:"分组倍率",extraText:"",placeholder:"为一个 JSON 文本，键为分组名称，值为倍率",field:"GroupRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(h,l)=>su(l),message:"不是合法的 JSON 字符串"}],onChange:h=>o({...a,GroupRatio:h})})})})]})}),e.jsxs(he,{children:[e.jsx(P,{onClick:v,children:"保存倍率设置"}),e.jsx(ve,{title:"确定重置模型倍率吗？",content:"此修改将不可逆",okType:"danger",position:"top",onConfirm:()=>{F()},children:e.jsx(P,{type:"danger",children:"重置模型倍率"})})]})]})}const Gn=()=>{let[u,n]=t.useState({QuotaForNewUser:0,QuotaForInviter:0,QuotaForInvitee:0,QuotaRemindThreshold:0,PreConsumedQuota:0,StreamCacheQueueLength:0,ModelRatio:"",CompletionRatio:"",ModelPrice:"",GroupRatio:"",TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:0,AutomaticDisableChannelEnabled:!1,AutomaticEnableChannelEnabled:!1,ChannelDisableThreshold:0,LogConsumeEnabled:!1,DisplayInCurrencyEnabled:!1,DisplayTokenStatEnabled:!1,CheckSensitiveEnabled:!1,CheckSensitiveOnPromptEnabled:!1,CheckSensitiveOnCompletionEnabled:"",StopOnSensitiveEnabled:"",SensitiveWords:"",MjNotifyEnabled:!1,MjAccountFilterEnabled:!1,MjModeClearEnabled:!1,MjForwardUrlEnabled:!1,MjActionCheckSuccessEnabled:!1,DrawingEnabled:!1,DataExportEnabled:!1,DataExportDefaultTime:"hour",DataExportInterval:5,DefaultCollapseSidebar:!1,RetryTimes:0}),[c,a]=t.useState(!1);const o=async()=>{const p=await M.get("/api/option/"),{success:j,message:v,data:F}=p.data;if(j){let h={};F.forEach(l=>{(l.key==="ModelRatio"||l.key==="GroupRatio"||l.key==="CompletionRatio"||l.key==="ModelPrice")&&(l.value=JSON.stringify(JSON.parse(l.value),null,2)),l.key.endsWith("Enabled")||["DefaultCollapseSidebar"].includes(l.key)?h[l.key]=l.value==="true":h[l.key]=l.value}),n(h)}else f(v)};async function i(){try{a(!0),await o(),Y("刷新成功")}catch{f("刷新失败")}finally{a(!1)}}return t.useEffect(()=>{i()},[]),e.jsx(e.Fragment,{children:e.jsxs(De,{spinning:c,size:"large",children:[e.jsx(Be,{style:{marginTop:"10px"},children:e.jsx(Mn,{options:u,refresh:i})}),e.jsx(Be,{style:{marginTop:"10px"},children:e.jsx(Rn,{options:u,refresh:i})}),e.jsx(Be,{style:{marginTop:"10px"},children:e.jsx(On,{options:u,refresh:i})}),e.jsx(Be,{style:{marginTop:"10px"},children:e.jsx(Nn,{options:u,refresh:i})}),e.jsx(Be,{style:{marginTop:"10px"},children:e.jsx(Un,{options:u,refresh:i})}),e.jsx(Be,{style:{marginTop:"10px"},children:e.jsx(Wn,{options:u,refresh:i})}),e.jsx(Be,{style:{marginTop:"10px"},children:e.jsx(Kn,{options:u,refresh:i})}),e.jsx(Be,{style:{marginTop:"10px"},children:e.jsx(Hn,{options:u,refresh:i})})]})})},qn=()=>{const u=Oe(),n=Qt(),[c,a]=t.useState("1");let o=[{tab:"个人设置",content:e.jsx($n,{}),itemKey:"personal"}];pt()&&(o.push({tab:"运营设置",content:e.jsx(Gn,{}),itemKey:"operation"}),o.push({tab:"系统设置",content:e.jsx(In,{}),itemKey:"system"}),o.push({tab:"其他设置",content:e.jsx(Pn,{}),itemKey:"other"}));const i=p=>{a(p),u(`?tab=${p}`)};return t.useEffect(()=>{const j=new URLSearchParams(window.location.search).get("tab");j?a(j):i("personal")},[n.search]),e.jsx("div",{children:e.jsx(ae,{children:e.jsx(ae.Content,{children:e.jsx(vt,{type:"line",activeKey:c,onChange:p=>i(p),children:o.map(p=>e.jsx(kt,{itemKey:p.itemKey,tab:p.tab,children:c===p.itemKey&&p.content},p.itemKey))})})})})},Vn=()=>{const[u,n]=t.useState({email:""}),{email:c}=u,[a,o]=t.useState(!1),[i,p]=t.useState(!1),[j,v]=t.useState(""),[F,h]=t.useState(""),[l,E]=t.useState(!1),[k,z]=t.useState(30);t.useEffect(()=>{let w=null;return l&&k>0?w=setInterval(()=>{z(k-1)},1e3):k===0&&(E(!1),z(30)),()=>clearInterval(w)},[l,k]);function _(w){const{name:V,value:H}=w.target;n(W=>({...W,[V]:H}))}async function N(w){if(E(!0),!c)return;if(i&&F===""){Ae("请稍后几秒重试，Turnstile 正在检查用户环境！");return}o(!0);const V=await M.get(`/api/reset_password?email=${c}&turnstile=${F}`),{success:H,message:W}=V.data;H?(Y("重置邮件发送成功，请检查邮箱！"),n({...u,email:""})):f(W),o(!1)}return e.jsx(ru,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(ru.Column,{style:{maxWidth:450},children:[e.jsxs(ye,{as:"h2",color:"",textAlign:"center",children:[e.jsx(Ft,{src:"/logo.png"})," 密码重置"]}),e.jsx(G,{size:"large",children:e.jsxs(Nu,{children:[e.jsx(G.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:c,onChange:_}),i?e.jsx(au,{sitekey:j,onVerify:w=>{h(w)}}):e.jsx(e.Fragment,{}),e.jsx(iu,{color:"green",fluid:!0,size:"large",onClick:N,loading:a,disabled:l,children:l?`重试 (${k})`:"提交"})]})})]})})},Qn=()=>{const[u,n]=zu(),[c,a]=t.useContext(Ze),[o,i]=t.useState("处理中...");t.useState(!0);let p=Oe();const j=async(v,F,h)=>{const l=await M.get(`/api/oauth/github?code=${v}&state=${F}`),{success:E,message:k,data:z}=l.data;if(E)k==="bind"?(Y("绑定成功！"),p("/setting")):(a({type:"login",payload:z}),localStorage.setItem("user",JSON.stringify(z)),Y("登录成功！"),p("/"));else{f(k);{i("操作失败，重定向至登录界面中..."),p("/setting");return}}};return t.useEffect(()=>{let v=u.get("code"),F=u.get("state");j(v,F).then()},[]),e.jsx(Nu,{style:{minHeight:"300px"},children:e.jsx(tn,{active:!0,inverted:!0,children:e.jsx(nn,{size:"large",children:o})})})},Jn=()=>{const[u,n]=t.useState({email:"",token:""}),{email:c,token:a}=u,[o,i]=t.useState(!1),[p,j]=t.useState(!1),[v,F]=t.useState(30),[h,l]=t.useState(""),[E,k]=zu();t.useEffect(()=>{let _=E.get("token"),N=E.get("email");n({token:_,email:N})},[]),t.useEffect(()=>{let _=null;return p&&v>0?_=setInterval(()=>{F(v-1)},1e3):v===0&&(j(!1),F(30)),()=>clearInterval(_)},[p,v]);async function z(_){if(j(!0),!c)return;i(!0);const N=await M.post("/api/user/reset",{email:c,token:a}),{success:w,message:V}=N.data;if(w){let H=N.data.data;l(H),await Re(H),Gu(`新密码已复制到剪贴板：${H}`)}else f(V);i(!1)}return e.jsx(ru,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(ru.Column,{style:{maxWidth:450},children:[e.jsxs(ye,{as:"h2",color:"",textAlign:"center",children:[e.jsx(Ft,{src:"/logo.png"})," 密码重置确认"]}),e.jsx(G,{size:"large",children:e.jsxs(Nu,{children:[e.jsx(G.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:c,readOnly:!0}),h&&e.jsx(G.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"新密码",name:"newPassword",value:h,readOnly:!0,onClick:_=>{_.target.select(),navigator.clipboard.writeText(h),Gu(`密码已复制到剪贴板：${h}`)}}),e.jsx(iu,{color:"green",fluid:!0,size:"large",onClick:z,loading:o,disabled:p,children:p?"密码重置完成":"提交"})]})})]})})},Vu={"gpt-3.5-turbo-0301":"gpt-3.5-turbo","gpt-4-0314":"gpt-4","gpt-4-32k-0314":"gpt-4-32k"},Qu={400:"500"},Yn="1. 新建渠道时，请求通过当前浏览器发出；2. 编辑已有渠道，请求通过后端服务器发出";function Zn(u){switch(u){case 15:return"按照如下格式输入：APIKey|SecretKey";case 18:return"按照如下格式输入：APPID|APISecret|APIKey";case 22:return"按照如下格式输入：APIKey-AppId，例如：fastgpt-0sp2gtvfdgyi4k30jwlgwf1i-64f335d84283f05518e9e041";case 23:return"按照如下格式输入：AppId|SecretId|SecretKey";case 33:return"按照如下格式输入：Ak|Sk|Region";default:return"请输入渠道对应的鉴权密钥"}}const Ru=u=>{Oe();const n=u.editingChannel.id,c=n!==void 0,[a,o]=t.useState(c),i=()=>{u.handleClose()},p={name:"",type:1,key:"",openai_organization:"",max_input_tokens:0,base_url:"",other:"",model_mapping:"",status_code_mapping:"",models:[],auto_ban:1,test_model:"",groups:["default"]},[j,v]=t.useState(!1),[F,h]=t.useState(!0),[l,E]=t.useState(p),[k,z]=t.useState([]),[_,N]=t.useState([]),[w,V]=t.useState([]),[H,W]=t.useState([]),[Z,Q]=t.useState([]),[ee,te]=t.useState(""),K=(s,r)=>{if(E(m=>({...m,[s]:r})),s==="type"){let m=[];switch(r){case 2:m=["mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_uploads"];break;case 5:m=["swap_face","mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_zoom","mj_shorten","mj_modal","mj_inpaint","mj_custom_zoom","mj_high_variation","mj_low_variation","mj_pan","mj_uploads"];break;case 36:m=["suno_music","suno_lyrics"];break;default:m=vu(r);break}l.models.length===0&&E(S=>({...S,models:m})),W(m)}},b=async()=>{o(!0);let s=await M.get(`/api/channel/${n}`);if(s===void 0)return;const{success:r,message:m,data:S}=s.data;r?(S.models===""?S.models=[]:S.models=S.models.split(","),S.group===""?S.groups=[]:S.groups=S.group.split(","),S.model_mapping!==""&&(S.model_mapping=JSON.stringify(JSON.parse(S.model_mapping),null,2)),E(S),S.auto_ban===0?h(!1):h(!0),W(vu(S.type))):f(m),o(!1)},g=async s=>{var S,d;if(l.type!==1){f("仅支持 OpenAI 接口格式");return}o(!0);const r=l.models||[];let m=!1;if(c){const D=await M.get("/api/channel/fetch_models/"+n);D.data&&((S=D.data)!=null&&S.success)?r.push(...D.data.data):m=!0}else if(!(l!=null&&l.key))f("请填写密钥"),m=!0;else try{const B=`https://${new URL(l.base_url||"https://api.openai.com").hostname}/v1/models`,L=l.key,J=await Lu.get(B,{headers:{Authorization:`Bearer ${L}`}});J.data&&((d=J.data)!=null&&d.success)?r.push(...J.data.data.map(y=>y.id)):m=!0}catch{m=!0}m?f("获取模型列表失败"):(K(s,Array.from(new Set(r))),Y("获取模型列表成功")),o(!1)},x=async()=>{try{let s=await M.get("/api/channel/models"),r=s.data.data.map(m=>({label:m.id,value:m.id}));z(r),Q(s.data.data.map(m=>m.id)),W(s.data.data.filter(m=>m.id.startsWith("gpt-3")||m.id.startsWith("text-")).map(m=>m.id))}catch(s){f(s.message)}},R=async()=>{try{let s=await M.get("/api/group/");if(s===void 0)return;V(s.data.data.map(r=>({label:r,value:r})))}catch(s){f(s.message)}};t.useEffect(()=>{let s=[...k];l.models.forEach(r=>{s.find(m=>m.key===r)||s.push({label:r,value:r})}),N(s)},[k,l.models]),t.useEffect(()=>{if(x().then(),R().then(),c)b().then(()=>{});else{E(p);let s=vu(l.type);W(s),E(r=>({...r,models:s}))}},[u.editingChannel.id]);const C=async()=>{if(!c&&(l.name===""||l.key==="")){Ae("请填写渠道名称和渠道密钥！");return}if(l.models.length===0){Ae("请至少选择一个模型！");return}if(l.model_mapping!==""&&!su(l.model_mapping)){Ae("模型映射必须是合法的 JSON 格式！");return}let s={...l};s.base_url&&s.base_url.endsWith("/")&&(s.base_url=s.base_url.slice(0,s.base_url.length-1)),s.type===3&&s.other===""&&(s.other="2023-06-01-preview"),s.type===18&&s.other===""&&(s.other="v2.1");let r;if(!Array.isArray(s.models)){f("提交失败，请勿重复提交！"),i();return}s.auto_ban=F?1:0,s.models=s.models.join(","),s.group=s.groups.join(","),c?r=await M.put("/api/channel/",{...s,id:parseInt(n)}):r=await M.post("/api/channel/",s);const{success:m,message:S}=r.data;m?(c?Y("渠道更新成功！"):(Y("渠道创建成功！"),E(p)),u.refresh(),u.handleClose()):f(S)},A=()=>{if(ee.trim()==="")return;const s=ee.split(",").map(d=>d.trim());let r=[...l.models],m=[..._],S=!1;s.forEach(d=>{d&&!r.includes(d)?(r.push(d),m.push({key:d,text:d,value:d})):d&&(f("某些模型已存在！"),S=!0)}),!S&&(N(m),te(""),K("models",r))};return e.jsx(e.Fragment,{children:e.jsx(hu,{maskClosable:!1,placement:c?"right":"left",title:e.jsx(Ve,{level:3,children:c?"更新渠道信息":"创建新的渠道"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(he,{children:[e.jsx(P,{theme:"solid",size:"large",onClick:C,children:"提交"}),e.jsx(P,{theme:"solid",size:"large",type:"tertiary",onClick:i,children:"取消"})]})}),closeIcon:null,onCancel:()=>i(),width:_e()?"100%":600,children:e.jsxs(De,{spinning:a,children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"类型："})}),e.jsx(Me,{name:"type",required:!0,optionList:ju,value:l.type,onChange:s=>K("type",s),style:{width:"50%"}}),l.type===3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Ke,{type:"warning",description:e.jsxs(e.Fragment,{children:["注意，",e.jsx("strong",{children:"模型部署名称必须和模型名称保持一致"}),"，因为 One API 会把请求体中的 model 参数替换为你的部署名称（模型名称中的点会被剔除），",e.jsx("a",{target:"_blank",href:"https://github.com/songquanpeng/one-api/issues/133?notification_referrer_id=NT_kwDOAmJSYrM2NjIwMzI3NDgyOjM5OTk4MDUw#issuecomment-1571602271",children:"图片演示"}),"。"]})})}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"AZURE_OPENAI_ENDPOINT："})}),e.jsx(se,{label:"AZURE_OPENAI_ENDPOINT",name:"azure_base_url",placeholder:"请输入 AZURE_OPENAI_ENDPOINT，例如：https://docs-test-001.openai.azure.com",onChange:s=>{K("base_url",s)},value:l.base_url,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"默认 API 版本："})}),e.jsx(se,{label:"默认 API 版本",name:"azure_other",placeholder:"请输入默认 API 版本，例如：2023-06-01-preview，该配置可以被实际的请求查询参数所覆盖",onChange:s=>{K("other",s)},value:l.other,autoComplete:"new-password"})]}),l.type===8&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Ke,{type:"warning",description:e.jsx(e.Fragment,{children:"如果你对接的是上游One API或者New API等转发项目，请使用OpenAI类型，不要使用此类型，除非你知道你在做什么。"})})}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(X.Text,{strong:!0,children:["完整的 Base URL，支持变量","{model}","："]})}),e.jsx(se,{name:"base_url",placeholder:"请输入完整的URL，例如：https://api.openai.com/v1/chat/completions",onChange:s=>{K("base_url",s)},value:l.base_url,autoComplete:"new-password"})]}),l.type===36&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"注意非Chat API，请务必填写正确的API地址，否则可能导致无法使用"})}),e.jsx(se,{name:"base_url",placeholder:"请输入到 /suno 前的路径，通常就是域名，例如：https://api.example.com ",onChange:s=>{K("base_url",s)},value:l.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"名称："})}),e.jsx(se,{required:!0,name:"name",placeholder:"请为渠道命名",onChange:s=>{K("name",s)},value:l.name,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"分组："})}),e.jsx(Me,{placeholder:"请选择可以使用该渠道的分组",name:"groups",required:!0,multiple:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:s=>{K("groups",s)},value:l.groups,autoComplete:"new-password",optionList:w}),l.type===18&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"模型版本："})}),e.jsx(se,{name:"other",placeholder:"请输入星火大模型版本，注意是接口地址中的版本号，例如：v2.1",onChange:s=>{K("other",s)},value:l.other,autoComplete:"new-password"})]}),l.type===21&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"知识库 ID："})}),e.jsx(se,{label:"知识库 ID",name:"other",placeholder:"请输入知识库 ID，例如：123456",onChange:s=>{K("other",s)},value:l.other,autoComplete:"new-password"})]}),l.type===39&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"Account ID："})}),e.jsx(se,{name:"other",placeholder:"请输入Account ID，例如：d6b5da8hk1awo8nap34ube6gh",onChange:s=>{K("other",s)},value:l.other,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"模型："})}),e.jsx(Me,{placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:s=>{K("models",s)},value:l.models,autoComplete:"new-password",optionList:_}),e.jsxs("div",{style:{lineHeight:"40px",marginBottom:"12px"},children:[e.jsxs(he,{children:[e.jsx(P,{type:"primary",onClick:()=>{K("models",H)},children:"填入相关模型"}),e.jsx(P,{type:"secondary",onClick:()=>{K("models",Z)},children:"填入所有模型"}),e.jsx(Ie,{content:Yn,children:e.jsx(P,{type:"tertiary",onClick:()=>{g("models")},children:"获取模型列表"})}),e.jsx(P,{type:"warning",onClick:()=>{K("models",[])},children:"清除所有模型"})]}),e.jsx(se,{addonAfter:e.jsx(P,{type:"primary",onClick:A,children:"填入"}),placeholder:"输入自定义模型名称",value:ee,onChange:s=>{te(s.trim())}})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"模型重定向："})}),e.jsx(Su,{placeholder:`此项可选，用于修改请求体中的模型名称，为一个 JSON 字符串，键为请求中模型名称，值为要替换的模型名称，例如：
${JSON.stringify(Vu,null,2)}`,name:"model_mapping",onChange:s=>{K("model_mapping",s)},autosize:!0,value:l.model_mapping,autoComplete:"new-password"}),e.jsx(X.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{K("model_mapping",JSON.stringify(Vu,null,2))},children:"填入模板"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"密钥："})}),j?e.jsx(Su,{label:"密钥",name:"key",required:!0,placeholder:"请输入密钥，一行一个",onChange:s=>{K("key",s)},value:l.key,style:{minHeight:150,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password"}):e.jsx(se,{label:"密钥",name:"key",required:!0,placeholder:Zn(l.type),onChange:s=>{K("key",s)},value:l.key,autoComplete:"new-password"}),l.type===1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"组织："})}),e.jsx(se,{label:"组织，可选，不填则为默认组织",name:"openai_organization",placeholder:"请输入组织org-xxx",onChange:s=>{K("openai_organization",s)},value:l.openai_organization})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"默认测试模型："})}),e.jsx(se,{name:"test_model",placeholder:"不填则为模型列表第一个",onChange:s=>{K("test_model",s)},value:l.test_model}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(he,{children:[e.jsx(_u,{name:"auto_ban",checked:F,onChange:()=>{h(!F)}}),e.jsx(X.Text,{strong:!0,children:"是否自动禁用（仅当自动禁用开启时有效），关闭后不会自动禁用该渠道："})]})}),!c&&e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(he,{children:[e.jsx(_u,{checked:j,label:"批量创建",name:"batch",onChange:()=>v(!j)}),e.jsx(X.Text,{strong:!0,children:"批量创建"})]})}),l.type!==3&&l.type!==8&&l.type!==22&&l.type!==36&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"代理："})}),e.jsx(se,{label:"代理",name:"base_url",placeholder:"此项可选，用于通过代理站来进行 API 调用",onChange:s=>{K("base_url",s)},value:l.base_url,autoComplete:"new-password"})]}),l.type===22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"私有部署地址："})}),e.jsx(se,{name:"base_url",placeholder:"请输入私有部署地址，格式为：https://fastgpt.run/api/openapi",onChange:s=>{K("base_url",s)},value:l.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(X.Text,{strong:!0,children:"状态码复写（仅影响本地判断，不修改返回到上游的状态码）："})}),e.jsx(Su,{placeholder:`此项可选，用于复写返回的状态码，比如将claude渠道的400错误复写为500（用于重试），请勿滥用该功能，例如：
${JSON.stringify(Qu,null,2)}`,name:"status_code_mapping",onChange:s=>{K("status_code_mapping",s)},autosize:!0,value:l.status_code_mapping,autoComplete:"new-password"}),e.jsx(X.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{K("status_code_mapping",JSON.stringify(Qu,null,2))},children:"填入模板"})]})})})};let nu;function Xn(u){var n,c;if(!nu){nu=new Map;for(let a=0;a<ju.length;a++)nu[ju[a].value]=ju[a];nu[0]={value:0,text:"未知类型",color:"grey"}}return e.jsx($,{size:"large",color:(n=nu[u])==null?void 0:n.color,children:(c=nu[u])==null?void 0:c.text})}const es=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"分组",dataIndex:"group",render:(T,O,ne)=>e.jsx("div",{children:e.jsx(he,{spacing:2,children:T.split(",").map((re,Fe)=>xt(re))})})},{title:"类型",dataIndex:"type",render:(T,O,ne)=>e.jsx("div",{children:Xn(T)})},{title:"状态",dataIndex:"status",render:(T,O,ne)=>{if(T===3){O.other_info===""&&(O.other_info="{}");let re=JSON.parse(O.other_info),Fe=re.status_reason,Ce=re.status_time;return e.jsx("div",{children:e.jsx(Ie,{content:"原因："+Fe+"，时间："+Te(Ce),children:L(T)})})}else return L(T)}},{title:"响应时间",dataIndex:"response_time",render:(T,O,ne)=>e.jsx("div",{children:J(T)})},{title:"已用/剩余",dataIndex:"expired_time",render:(T,O,ne)=>e.jsx("div",{children:e.jsxs(he,{spacing:1,children:[e.jsx(Ie,{content:"已用额度",children:e.jsx($,{color:"white",type:"ghost",size:"large",children:me(O.used_quota)})}),e.jsx(Ie,{content:"剩余额度"+O.balance+"，点击更新",children:e.jsxs($,{color:"white",type:"ghost",size:"large",onClick:()=>{le(O)},children:["$",Fn(O.balance)]})})]})})},{title:"优先级",dataIndex:"priority",render:(T,O,ne)=>e.jsx("div",{children:e.jsx(ku,{style:{width:70},name:"priority",onBlur:re=>{B(O.id,"priority",O,re.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:O.priority,min:-999})})},{title:"权重",dataIndex:"weight",render:(T,O,ne)=>e.jsx("div",{children:e.jsx(ku,{style:{width:70},name:"weight",onBlur:re=>{B(O.id,"weight",O,re.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:O.weight,min:0})})},{title:"",dataIndex:"operate",render:(T,O,ne)=>e.jsxs("div",{children:[e.jsxs(at,{style:{marginRight:1},"aria-label":"测试操作项目组",children:[e.jsx(P,{theme:"light",onClick:()=>{U(O,"")},children:"测试"}),e.jsx(qe,{trigger:"click",position:"bottomRight",menu:O.test_models,children:e.jsx(P,{style:{padding:"8px 4px"},type:"primary",icon:e.jsx(rt,{})})})]}),e.jsx(ve,{title:"确定是否要删除此渠道？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{B(O.id,"delete",O).then(()=>{r(O.id)})},children:e.jsx(P,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),O.status===1?e.jsx(P,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{B(O.id,"disable",O)},children:"禁用"}):e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{B(O.id,"enable",O)},children:"启用"}),e.jsx(P,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{C(O),b(!0)},children:"编辑"}),e.jsx(ve,{title:"确定是否要复制此渠道？",content:"复制渠道的所有信息",okType:"danger",position:"left",onConfirm:async()=>{d(O.id)},children:e.jsx(P,{theme:"light",type:"primary",style:{marginRight:1},children:"复制"})})]})}],[n,c]=t.useState([]),[a,o]=t.useState(!0),[i,p]=t.useState(1),[j,v]=t.useState(!1),[F,h]=t.useState(""),[l,E]=t.useState(""),[k,z]=t.useState(""),[_,N]=t.useState(!1),[w,V]=t.useState(!1),[H,W]=t.useState(de);t.useState(dn("channel-test"));const[Z,Q]=t.useState(H),[ee,te]=t.useState([]),[K,b]=t.useState(!1),[g,x]=t.useState(!1),[R,C]=t.useState({id:void 0}),[A,s]=t.useState([]),r=T=>{let O=[...n];if(T!=null){let ne=O.findIndex(re=>re.id===T);ne>-1&&(O.splice(ne,1),c(O))}},m=T=>{for(let O=0;O<T.length;O++){T[O].key=""+T[O].id;let ne=[];T[O].models.split(",").forEach((re,Fe)=>{ne.push({node:"item",name:re,onClick:()=>{U(T[O],re)}})}),T[O].test_models=ne}c(T),T.length>=H?Q(T.length+H):Q(T.length)},S=async(T,O,ne)=>{o(!0);const re=await M.get(`/api/channel/?p=${T}&page_size=${O}&id_sort=${ne}`);if(re===void 0)return;const{success:Fe,message:Ce,data:Ne}=re.data;if(Fe)if(T===0)m(Ne);else{let Xe=[...n];Xe.splice(T*O,Ne.length,...Ne),m(Xe)}else f(Ce);o(!1)},d=async T=>{const O=n.find(ne=>String(ne.id)===String(T));if(console.log(O),O.name+="_复制",O.created_time=null,O.balance=0,O.used_quota=0,!O){f("渠道未找到，请刷新页面后重试。");return}try{const ne={...O,id:void 0},re=await M.post("/api/channel/",ne);re.data.success?(Y("渠道复制成功"),await D()):f(re.data.message)}catch(ne){f("渠道复制失败: "+ne.message)}},D=async()=>{await S(i-1,H,j)};t.useEffect(()=>{const T=localStorage.getItem("id-sort")==="true",O=parseInt(localStorage.getItem("page-size"))||de;v(T),W(O),S(0,O,T).then().catch(ne=>{f(ne)}),bu().then(),An().then()},[]);const B=async(T,O,ne,re)=>{let Fe={id:T},Ce;switch(O){case"delete":Ce=await M.delete(`/api/channel/${T}/`);break;case"enable":Fe.status=1,Ce=await M.put("/api/channel/",Fe);break;case"disable":Fe.status=2,Ce=await M.put("/api/channel/",Fe);break;case"priority":if(re==="")return;Fe.priority=parseInt(re),Ce=await M.put("/api/channel/",Fe);break;case"weight":if(re==="")return;Fe.weight=parseInt(re),Fe.weight<0&&(Fe.weight=0),Ce=await M.put("/api/channel/",Fe);break}const{success:Ne,message:Xe}=Ce.data;if(Ne){Y("操作成功完成！");let xu=Ce.data.data,q=[...n];O==="delete"||(ne.status=xu.status),c(q)}else f(Xe)},L=T=>{switch(T){case 1:return e.jsx($,{size:"large",color:"green",children:"已启用"});case 2:return e.jsx($,{size:"large",color:"yellow",children:"已禁用"});case 3:return e.jsx($,{size:"large",color:"yellow",children:"自动禁用"});default:return e.jsx($,{size:"large",color:"grey",children:"未知状态"})}},J=T=>{let O=T/1e3;return O=O.toFixed(2)+" 秒",T===0?e.jsx($,{size:"large",color:"grey",children:"未测试"}):T<=1e3?e.jsx($,{size:"large",color:"green",children:O}):T<=3e3?e.jsx($,{size:"large",color:"lime",children:O}):T<=5e3?e.jsx($,{size:"large",color:"yellow",children:O}):e.jsx($,{size:"large",color:"red",children:O})},y=async(T,O,ne)=>{if(T===""&&O===""&&ne===""){await S(0,H,j),p(1);return}N(!0);const re=await M.get(`/api/channel/search?keyword=${T}&group=${O}&model=${ne}`),{success:Fe,message:Ce,data:Ne}=re.data;Fe?(m(Ne),p(1)):f(Ce),N(!1)},U=async(T,O)=>{const ne=await M.get(`/api/channel/test/${T.id}?model=${O}`),{success:re,message:Fe,time:Ce}=ne.data;re?(T.response_time=Ce*1e3,T.test_time=Date.now()/1e3,Ae(`通道 ${T.name} 测试成功，耗时 ${Ce.toFixed(2)} 秒。`)):f(Fe)},ue=async()=>{const T=await M.get("/api/channel/test"),{success:O,message:ne}=T.data;O?Ae("已成功开始测试所有通道，请刷新页面查看结果。"):f(ne)},ie=async()=>{const T=await M.delete("/api/channel/disabled"),{success:O,message:ne,data:re}=T.data;O?(Y(`已删除所有禁用渠道，共计 ${re} 个`),await D()):f(ne)},le=async T=>{const O=await M.get(`/api/channel/update_balance/${T.id}/`),{success:ne,message:re,balance:Fe}=O.data;ne?(T.balance=Fe,T.balance_updated_time=Date.now()/1e3,Ae(`通道 ${T.name} 余额更新成功！`)):f(re)},oe=async()=>{V(!0);const T=await M.get("/api/channel/update_balance"),{success:O,message:ne}=T.data;O?Ae("已更新完毕所有已启用通道余额！"):f(ne),V(!1)},be=async()=>{if(A.length===0){f("请先选择要删除的通道！");return}o(!0);let T=[];A.forEach(Ce=>{T.push(Ce.id)});const O=await M.post("/api/channel/batch",{ids:T}),{success:ne,message:re,data:Fe}=O.data;ne?(Y(`已删除 ${Fe} 个通道！`),await D()):f(re),o(!1)},Pe=async()=>{const T=await M.post("/api/channel/fix"),{success:O,message:ne,data:re}=T.data;O?(Y(`已修复 ${re} 个通道！`),await D()):f(ne)};let ze=n.slice((i-1)*H,i*H);const Le=T=>{p(T),T===Math.ceil(n.length/H)+1&&S(T-1,H,j).then(O=>{})},tu=async T=>{localStorage.setItem("page-size",T+""),W(T),p(1),S(0,T,j).then().catch(O=>{f(O)})},bu=async()=>{try{let T=await M.get("/api/group/");if(T===void 0)return;te(T.data.data.map(O=>({label:O,value:O})))}catch(T){f(T.message)}},mu=()=>{b(!1)},gu=(T,O)=>T.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(Ru,{refresh:D,visible:K,handleClose:mu,editingChannel:R}),e.jsx(I,{onSubmit:()=>{y(F,l,k)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(he,{children:[e.jsx(I.Input,{field:"search_keyword",label:"搜索渠道关键词",placeholder:"ID，名称和密钥 ...",value:F,loading:_,onChange:T=>{h(T.trim())}}),e.jsx(I.Input,{field:"search_model",label:"模型",placeholder:"模型关键字",value:k,loading:_,onChange:T=>{z(T.trim())}}),e.jsx(I.Select,{field:"group",label:"分组",optionList:ee,onChange:T=>{E(T),y(F,T,k)}}),e.jsx(P,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsx(he,{children:e.jsxs(he,{children:[e.jsx(X.Text,{strong:!0,children:"使用ID排序"}),e.jsx(Tu,{checked:j,label:"使用ID排序",uncheckedText:"关","aria-label":"是否用ID排序",onChange:T=>{localStorage.setItem("id-sort",T+""),v(T),S(0,H,T).then().catch(O=>{f(O)})}})]})})}),e.jsx(Qe,{className:"channel-table",style:{marginTop:15},columns:u,dataSource:ze,pagination:{currentPage:i,pageSize:H,total:Z,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,formatPageText:T=>"",onPageSizeChange:T=>{tu(T).then()},onPageChange:Le},loading:a,onRow:gu,rowSelection:g?{onChange:(T,O)=>{s(O)}}:null}),e.jsx("div",{style:{display:_e()?"":"flex",marginTop:_e()?0:-45,zIndex:999,position:"relative",pointerEvents:"none"},children:e.jsxs(he,{style:{pointerEvents:"auto",marginTop:_e()?0:45},children:[e.jsx(P,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{C({id:void 0}),b(!0)},children:"添加渠道"}),e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:ue,position:(_e(),"top"),children:e.jsx(P,{theme:"light",type:"warning",style:{marginRight:8},children:"测试所有通道"})}),e.jsx(ve,{title:"确定？",okType:"secondary",onConfirm:oe,children:e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:8},children:"更新所有已启用通道余额"})}),e.jsx(ve,{title:"确定是否要删除禁用通道？",content:"此修改将不可逆",okType:"danger",onConfirm:ie,children:e.jsx(P,{theme:"light",type:"danger",style:{marginRight:8},children:"删除禁用通道"})}),e.jsx(P,{theme:"light",type:"primary",style:{marginRight:8},onClick:D,children:"刷新"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(he,{children:[e.jsx(X.Text,{strong:!0,children:"开启批量删除"}),e.jsx(Tu,{label:"开启批量删除",uncheckedText:"关","aria-label":"是否开启批量删除",onChange:T=>{x(T)}}),e.jsx(ve,{title:"确定是否要删除所选通道？",content:"此修改将不可逆",okType:"danger",onConfirm:be,disabled:!g,position:"top",children:e.jsx(P,{disabled:!g,theme:"light",type:"danger",style:{marginRight:8},children:"删除所选通道"})}),e.jsx(ve,{title:"确定是否要修复数据库一致性？",content:"进行该操作时，可能导致渠道访问错误，请仅在数据库出现问题时使用",okType:"warning",onConfirm:Pe,position:"top",children:e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:8},children:"修复数据库一致性"})})]})})]})},us=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理渠道"})}),e.jsx(ae.Content,{children:e.jsx(es,{})})]})}),ts=u=>{const[n,c]=t.useState(!1),[a,o]=t.useState(n),i={name:"",remain_quota:n?0:5e5,expired_time:-1,unlimited_quota:!1,model_limits_enabled:!1,model_limits:[]},[p,j]=t.useState(i),{name:v,remain_quota:F,expired_time:h,unlimited_quota:l,model_limits_enabled:E,model_limits:k}=p,[z,_]=t.useState({});Oe();const N=(g,x)=>{j(R=>({...R,[g]:x}))},w=()=>{u.handleClose()},V=(g,x,R,C)=>{let s=new Date().getTime()/1e3,r=g*30*24*60*60;r+=x*24*60*60,r+=R*60*60,r+=C*60,r!==0?(s+=r,j({...p,expired_time:Te(s)})):j({...p,expired_time:-1})},H=()=>{j({...p,unlimited_quota:!l})},W=async()=>{let g=await M.get("/api/user/models");const{success:x,message:R,data:C}=g.data;if(x){let A=C.map(s=>({label:s,value:s}));_(A)}else f(R)},Z=async()=>{o(!0);let g=await M.get(`/api/token/${u.editingToken.id}`);const{success:x,message:R,data:C}=g.data;x?(C.expired_time!==-1&&(C.expired_time=Te(C.expired_time)),C.model_limits!==""?C.model_limits=C.model_limits.split(","):C.model_limits=[],j(C)):f(R),o(!1)};t.useEffect(()=>{c(u.editingToken.id!==void 0)},[u.editingToken.id]),t.useEffect(()=>{n?Z().then(()=>{}):j(i),W()},[n]);const[Q,ee]=t.useState(1),te=g=>{const x=parseInt(g,10);!isNaN(x)&&x>0&&ee(x)},K=()=>{const g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let x="";for(let R=0;R<6;R++)x+=g.charAt(Math.floor(Math.random()*g.length));return x},b=async()=>{if(o(!0),n){let g={...p};if(g.remain_quota=parseInt(g.remain_quota),g.expired_time!==-1){let A=Date.parse(g.expired_time);if(isNaN(A)){f("过期时间格式错误！"),o(!1);return}g.expired_time=Math.ceil(A/1e3)}g.model_limits=g.model_limits.join(",");let x=await M.put("/api/token/",{...g,id:parseInt(u.editingToken.id)});const{success:R,message:C}=x.data;R?(Y("令牌更新成功！"),u.refresh(),u.handleClose()):f(C)}else{let g=0;for(let x=0;x<Q;x++){let R={...p};if(x!==0&&(R.name=`${p.name}-${K()}`),R.remain_quota=parseInt(R.remain_quota),R.expired_time!==-1){let r=Date.parse(R.expired_time);if(isNaN(r)){f("过期时间格式错误！"),o(!1);break}R.expired_time=Math.ceil(r/1e3)}R.model_limits=R.model_limits.join(",");let C=await M.post("/api/token/",R);const{success:A,message:s}=C.data;if(A)g++;else{f(s);break}}g>0&&(Y(`${g}个令牌创建成功，请在列表页面点击复制获取令牌！`),u.refresh(),u.handleClose())}o(!1),j(i),ee(1)};return e.jsx(e.Fragment,{children:e.jsx(hu,{placement:n?"right":"left",title:e.jsx(Ve,{level:3,children:n?"更新令牌信息":"创建新的令牌"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(he,{children:[e.jsx(P,{theme:"solid",size:"large",onClick:b,children:"提交"}),e.jsx(P,{theme:"solid",size:"large",type:"tertiary",onClick:w,children:"取消"})]})}),closeIcon:null,onCancel:()=>w(),width:_e()?"100%":600,children:e.jsxs(De,{spinning:a,children:[e.jsx(se,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:g=>N("name",g),value:v,autoComplete:"new-password",required:!n}),e.jsx(we,{}),e.jsx(_t,{label:"过期时间",name:"expired_time",placeholder:"请选择过期时间",onChange:g=>N("expired_time",g),value:h,autoComplete:"new-password",type:"dateTime"}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(he,{children:[e.jsx(P,{type:"tertiary",onClick:()=>{V(0,0,0,0)},children:"永不过期"}),e.jsx(P,{type:"tertiary",onClick:()=>{V(0,0,1,0)},children:"一小时"}),e.jsx(P,{type:"tertiary",onClick:()=>{V(1,0,0,0)},children:"一个月"}),e.jsx(P,{type:"tertiary",onClick:()=>{V(0,1,0,0)},children:"一天"})]})}),e.jsx(we,{}),e.jsx(Ke,{type:"warning",description:"注意，令牌的额度仅用于限制令牌本身的最大额度使用量，实际的使用受到账户的剩余额度限制。"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:`额度${cu(F)}`})}),e.jsx(Iu,{style:{marginTop:8},name:"remain_quota",placeholder:"请输入额度",onChange:g=>N("remain_quota",g),value:F,autoComplete:"new-password",type:"number",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}],disabled:l}),!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:"新建数量"})}),e.jsx(Iu,{style:{marginTop:8},label:"数量",placeholder:"请选择或输入创建令牌的数量",onChange:g=>te(g),onSelect:g=>te(g),value:Q.toString(),autoComplete:"off",type:"number",data:[{value:10,label:"10个"},{value:20,label:"20个"},{value:30,label:"30个"},{value:100,label:"100个"}],disabled:l})]}),e.jsx("div",{children:e.jsx(P,{style:{marginTop:8},type:"warning",onClick:()=>{H()},children:l?"取消无限额度":"设为无限额度"})}),e.jsx(we,{}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(he,{children:[e.jsx(_u,{name:"model_limits_enabled",checked:E,onChange:g=>N("model_limits_enabled",g.target.checked)}),e.jsx(X.Text,{children:"启用模型限制（非必要，不建议启用）"})]})}),e.jsx(Me,{style:{marginTop:8},placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:g=>{N("model_limits",g)},value:p.model_limits,autoComplete:"new-password",optionList:z,disabled:!E})]})})})};function Ju(u){return e.jsx(e.Fragment,{children:Te(u)})}function ns(u,n=!1){switch(u){case 1:return n?e.jsx($,{color:"green",size:"large",children:"已启用：限制模型"}):e.jsx($,{color:"green",size:"large",children:"已启用"});case 2:return e.jsxs($,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs($,{color:"yellow",size:"large",children:[" ","已过期"," "]});case 4:return e.jsxs($,{color:"grey",size:"large",children:[" ","已耗尽"," "]});default:return e.jsxs($,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const ss=()=>{const u=[{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(B,L,J)=>e.jsx("div",{children:ns(B,L.model_limits_enabled)})},{title:"已用额度",dataIndex:"used_quota",render:(B,L,J)=>e.jsx("div",{children:me(parseInt(B))})},{title:"剩余额度",dataIndex:"remain_quota",render:(B,L,J)=>e.jsx("div",{children:L.unlimited_quota?e.jsx($,{size:"large",color:"white",children:"无限制"}):e.jsx($,{size:"large",color:"light-blue",children:me(parseInt(B))})})},{title:"创建时间",dataIndex:"created_time",render:(B,L,J)=>e.jsx("div",{children:Ju(B)})},{title:"过期时间",dataIndex:"expired_time",render:(B,L,J)=>e.jsx("div",{children:L.expired_time===-1?"永不过期":Ju(B)})},{title:"",dataIndex:"operate",render:(B,L,J)=>e.jsxs("div",{children:[e.jsx(lu,{content:"sk-"+L.key,style:{padding:20},position:"top",children:e.jsx(P,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async y=>{await x("sk-"+L.key)},children:"复制"}),e.jsxs(at,{style:{marginRight:1},"aria-label":"项目操作按钮组",children:[e.jsx(P,{theme:"light",style:{color:"rgba(var(--semi-teal-7), 1)"},onClick:()=>{R("next",L.key)},children:"聊天"}),e.jsx(qe,{trigger:"click",position:"bottomRight",menu:[{node:"item",key:"next",disabled:!localStorage.getItem("chat_link"),name:"ChatGPT Next Web",onClick:()=>{R("next",L.key)}},{node:"item",key:"next-mj",disabled:!localStorage.getItem("chat_link2"),name:"ChatGPT Web & Midjourney",onClick:()=>{R("next-mj",L.key)}},{node:"item",key:"lobe",name:"Lobe Chat",onClick:()=>{R("lobe",L.key)}},{node:"item",key:"ama",name:"AMA 问天（BotGem）",onClick:()=>{R("ama",L.key)}},{node:"item",key:"opencat",name:"OpenCat",onClick:()=>{R("opencat",L.key)}}],children:e.jsx(P,{style:{padding:"8px 4px",color:"rgba(var(--semi-teal-7), 1)"},type:"primary",icon:e.jsx(rt,{})})})]}),e.jsx(ve,{title:"确定是否要删除此令牌？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{A(L.id,"delete",L).then(()=>{C(L.key)})},children:e.jsx(P,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),L.status===1?e.jsx(P,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{A(L.id,"disable",L)},children:"禁用"}):e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{A(L.id,"enable",L)},children:"启用"}),e.jsx(P,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{Q(L),o(!0)},children:"编辑"})]})}],[n,c]=t.useState(de),[a,o]=t.useState(!1),[i,p]=t.useState([]),[j,v]=t.useState([]),[F,h]=t.useState(n),[l,E]=t.useState(!0),[k,z]=t.useState(1),[_,N]=t.useState(""),[w,V]=t.useState(""),[H,W]=t.useState(!1);t.useState(!1),t.useState(0);const[Z,Q]=t.useState({id:void 0}),ee=()=>{o(!1),setTimeout(()=>{Q({id:void 0})},500)},te=B=>{p(B),B.length>=n?h(B.length+n):h(B.length)};let K=i.slice((k-1)*n,k*n);const b=async B=>{E(!0);const L=await M.get(`/api/token/?p=${B}&size=${n}`),{success:J,message:y,data:U}=L.data;if(J)if(B===0)te(U);else{let ue=[...i];ue.splice(B*n,U.length,...U),te(ue)}else f(y);E(!1)},g=async()=>{await b(k-1)},x=async B=>{await Re(B)?Y("已复制到剪贴板！"):fe.error({title:"无法复制到剪贴板，请手动复制",content:B,size:"large"})},R=async(B,L)=>{let J=localStorage.getItem("status"),y="";J&&(J=JSON.parse(J),y=J.server_address),y===""&&(y=window.location.origin);let U=encodeURIComponent(y);const ue=localStorage.getItem("chat_link"),ie=localStorage.getItem("chat_link2");let le;ue&&(le=ue+`/#/?settings={"key":"sk-${L}","url":"${y}"}`);let oe;switch(B){case"ama":oe=`ama://set-api-key?server=${U}&key=sk-${L}`;break;case"opencat":oe=`opencat://team/join?domain=${U}&token=sk-${L}`;break;case"lobe":oe=`https://chat-preview.lobehub.com/?settings={"keyVaults":{"openai":{"apiKey":"sk-${L}","baseURL":"${U}"}}}`;break;case"next-mj":oe=ie+`/#/?settings={"key":"sk-${L}","url":"${y}"}`;break;default:if(!ue){f("管理员未设置聊天链接");return}oe=le}window.open(oe,"_blank")};t.useEffect(()=>{b(0).then().catch(B=>{f(B)})},[n]);const C=B=>{let L=[...i];if(B!=null){let J=L.findIndex(y=>y.key===B);J>-1&&(L.splice(J,1),te(L))}},A=async(B,L,J)=>{E(!0);let y={id:B},U;switch(L){case"delete":U=await M.delete(`/api/token/${B}/`);break;case"enable":y.status=1,U=await M.put("/api/token/?status_only=true",y);break;case"disable":y.status=2,U=await M.put("/api/token/?status_only=true",y);break}const{success:ue,message:ie}=U.data;if(ue){Y("操作成功完成！");let le=U.data.data,oe=[...i];L==="delete"||(J.status=le.status),te(oe)}else f(ie);E(!1)},s=async()=>{if(_===""&&w===""){await b(0),z(1);return}W(!0);const B=await M.get(`/api/token/search?keyword=${_}&token=${w}`),{success:L,message:J,data:y}=B.data;L?(te(y),z(1)):f(J),W(!1)},r=async B=>{N(B.trim())},m=async B=>{V(B.trim())},S=B=>{z(B),B===Math.ceil(i.length/n)+1&&b(B-1).then(L=>{})},d={onSelect:(B,L)=>{},onSelectAll:(B,L)=>{},onChange:(B,L)=>{v(L)}},D=(B,L)=>B.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(ts,{refresh:g,editingToken:Z,visiable:a,handleClose:ee}),e.jsxs(I,{layout:"horizontal",style:{marginTop:10},labelPosition:"left",children:[e.jsx(I.Input,{field:"keyword",label:"搜索关键字",placeholder:"令牌名称",value:_,loading:H,onChange:r}),e.jsx(I.Input,{field:"token",label:"Key",placeholder:"密钥",value:w,loading:H,onChange:m}),e.jsx(P,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:s,style:{marginRight:8},children:"查询"})]}),e.jsx(Qe,{style:{marginTop:20},columns:u,dataSource:K,pagination:{currentPage:k,pageSize:n,total:F,showSizeChanger:!0,pageSizeOptions:[10,20,50,100],formatPageText:B=>`第 ${B.currentStart} - ${B.currentEnd} 条，共 ${i.length} 条`,onPageSizeChange:B=>{c(B),z(1)},onPageChange:S},loading:l,rowSelection:d,onRow:D}),e.jsx(P,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{Q({id:void 0}),o(!0)},children:"添加令牌"}),e.jsx(P,{label:"复制所选令牌",type:"warning",onClick:async()=>{if(j.length===0){f("请至少选择一个令牌！");return}let B="";for(let L=0;L<j.length;L++)B+=j[L].name+"    sk-"+j[L].key+`
`;await x(B)},children:"复制所选令牌到剪贴板"})]})},as=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"我的令牌"})}),e.jsx(ae.Content,{children:e.jsx(ss,{})})]})}),rs=u=>{const n=u.editingRedemption.id!==void 0,[c,a]=t.useState(n);Jt(),Oe();const o={name:"",quota:1e5,count:1},[i,p]=t.useState(o),{name:j,quota:v,count:F}=i,h=()=>{u.handleClose()},l=(z,_)=>{p(N=>({...N,[z]:_}))},E=async()=>{a(!0);let z=await M.get(`/api/redemption/${u.editingRedemption.id}`);const{success:_,message:N,data:w}=z.data;_?p(w):f(N),a(!1)};t.useEffect(()=>{n?E().then(()=>{}):p(o)},[u.editingRedemption.id]);const k=async()=>{if(!n&&i.name==="")return;a(!0);let z=i;z.count=parseInt(z.count),z.quota=parseInt(z.quota);let _;n?_=await M.put("/api/redemption/",{...z,id:parseInt(u.editingRedemption.id)}):_=await M.post("/api/redemption/",{...z});const{success:N,message:w,data:V}=_.data;if(N?n?(Y("兑换码更新成功！"),u.refresh(),u.handleClose()):(Y("兑换码创建成功！"),p(o),u.refresh(),u.handleClose()):f(w),!n&&V){let H="";for(let W=0;W<V.length;W++)H+=V[W]+`
`;fe.confirm({title:"兑换码创建成功",content:e.jsxs("div",{children:[e.jsx("p",{children:"兑换码创建成功，是否下载兑换码？"}),e.jsx("p",{children:"兑换码将以文本文件的形式下载，文件名为兑换码的名称。"})]}),onOk:()=>{cn(H,`${i.name}.txt`)}})}a(!1)};return e.jsx(e.Fragment,{children:e.jsx(hu,{placement:n?"right":"left",title:e.jsx(Ve,{level:3,children:n?"更新兑换码信息":"创建新的兑换码"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(he,{children:[e.jsx(P,{theme:"solid",size:"large",onClick:k,children:"提交"}),e.jsx(P,{theme:"solid",size:"large",type:"tertiary",onClick:h,children:"取消"})]})}),closeIcon:null,onCancel:()=>h(),width:_e()?"100%":600,children:e.jsxs(De,{spinning:c,children:[e.jsx(se,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:z=>l("name",z),value:j,autoComplete:"new-password",required:!n}),e.jsx(we,{}),e.jsx("div",{style:{marginTop:20},children:e.jsx(X.Text,{children:`额度${cu(v)}`})}),e.jsx(Iu,{style:{marginTop:8},name:"quota",placeholder:"请输入额度",onChange:z=>l("quota",z),value:v,autoComplete:"new-password",type:"number",position:"bottom",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}]}),!n&&e.jsxs(e.Fragment,{children:[e.jsx(we,{}),e.jsx(X.Text,{children:"生成数量"}),e.jsx(se,{style:{marginTop:8},label:"生成数量",name:"count",placeholder:"请输入生成数量",onChange:z=>l("count",z),value:F,autoComplete:"new-password",type:"number"})]})]})})})};function is(u){return e.jsx(e.Fragment,{children:Te(u)})}function ls(u){switch(u){case 1:return e.jsx($,{color:"green",size:"large",children:"未使用"});case 2:return e.jsxs($,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs($,{color:"grey",size:"large",children:[" ","已使用"," "]});default:return e.jsxs($,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const os=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(s,r,m)=>e.jsx("div",{children:ls(s)})},{title:"额度",dataIndex:"quota",render:(s,r,m)=>e.jsx("div",{children:me(parseInt(s))})},{title:"创建时间",dataIndex:"created_time",render:(s,r,m)=>e.jsx("div",{children:is(s)})},{title:"兑换人ID",dataIndex:"used_user_id",render:(s,r,m)=>e.jsx("div",{children:s===0?"无":s})},{title:"",dataIndex:"operate",render:(s,r,m)=>e.jsxs("div",{children:[e.jsx(lu,{content:r.key,style:{padding:20},position:"top",children:e.jsx(P,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async S=>{await ee(r.key)},children:"复制"}),e.jsx(ve,{title:"确定是否要删除此兑换码？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{K(r.id,"delete",r).then(()=>{Q(r.key)})},children:e.jsx(P,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),r.status===1?e.jsx(P,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{K(r.id,"disable",r)},children:"禁用"}):e.jsx(P,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{K(r.id,"enable",r)},disabled:r.status===3,children:"启用"}),e.jsx(P,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{N(r),V(!0)},disabled:r.status!==1,children:"编辑"})]})}],[n,c]=t.useState([]),[a,o]=t.useState(!0),[i,p]=t.useState(1),[j,v]=t.useState(""),[F,h]=t.useState(!1),[l,E]=t.useState(de),[k,z]=t.useState([]),[_,N]=t.useState({id:void 0}),[w,V]=t.useState(!1),H=()=>{V(!1)},W=s=>{c(s),s.length>=i*de?E(s.length+1):E(s.length)},Z=async s=>{const r=await M.get(`/api/redemption/?p=${s}`),{success:m,message:S,data:d}=r.data;if(m)if(s===0)W(d);else{let D=n;D.push(...d),W(D)}else f(S);o(!1)},Q=s=>{let r=[...n];if(s!=null){let m=r.findIndex(S=>S.key===s);m>-1&&(r.splice(m,1),c(r))}},ee=async s=>{await Re(s)?Y("已复制到剪贴板！"):fe.error({title:"无法复制到剪贴板，请手动复制",content:s})};t.useEffect(()=>{Z(0).then().catch(s=>{f(s)})},[]);const te=async()=>{await Z(i-1)},K=async(s,r,m)=>{let S={id:s},d;switch(r){case"delete":d=await M.delete(`/api/redemption/${s}/`);break;case"enable":S.status=1,d=await M.put("/api/redemption/?status_only=true",S);break;case"disable":S.status=2,d=await M.put("/api/redemption/?status_only=true",S);break}const{success:D,message:B}=d.data;if(D){Y("操作成功完成！");let L=d.data.data,J=[...n];r==="delete"||(m.status=L.status),c(J)}else f(B)},b=async()=>{if(j===""){await Z(0),p(1);return}h(!0);const s=await M.get(`/api/redemption/search?keyword=${j}`),{success:r,message:m,data:S}=s.data;r?(c(S),p(1)):f(m),h(!1)},g=async s=>{v(s.trim())},x=s=>{p(s),s===Math.ceil(n.length/de)+1&&Z(s-1).then(r=>{})};let R=n.slice((i-1)*de,i*de);const C={onSelect:(s,r)=>{},onSelectAll:(s,r)=>{},onChange:(s,r)=>{z(r)}},A=(s,r)=>s.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(rs,{refresh:te,editingRedemption:_,visiable:w,handleClose:H}),e.jsx(I,{onSubmit:b,children:e.jsx(I.Input,{label:"搜索关键字",field:"keyword",icon:"search",iconPosition:"left",placeholder:"关键字(id或者名称)",value:j,loading:F,onChange:g})}),e.jsx(Qe,{style:{marginTop:20},columns:u,dataSource:R,pagination:{currentPage:i,pageSize:de,total:l,formatPageText:s=>`第 ${s.currentStart} - ${s.currentEnd} 条，共 ${n.length} 条`,onPageChange:x},loading:a,rowSelection:C,onRow:A}),e.jsx(P,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{N({id:void 0}),V(!0)},children:"添加兑换码"}),e.jsx(P,{label:"复制所选兑换码",type:"warning",onClick:async()=>{if(k.length===0){f("请至少选择一个兑换码！");return}let s="";for(let r=0;r<k.length;r++)s+=k[r].name+"    "+k[r].key+`
`;await ee(s)},children:"复制所选兑换码到剪贴板"})]})},cs=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理兑换码"})}),e.jsx(ae.Content,{children:e.jsx(os,{})})]})}),ds=()=>{const[u,n]=t.useState(""),[c,a]=t.useState(""),[o,i]=t.useState(0);t.useState(1);const[p,j]=t.useState(0),[v,F]=t.useState(1),[h,l]=t.useState(""),[E,k]=t.useState(!1),[z,_]=t.useState(0),[N,w]=t.useState(!1),[V,H]=t.useState(!1),[W,Z]=t.useState(""),Q=async()=>{if(u===""){Ae("请输入兑换码！");return}w(!0);try{const C=await M.post("/api/user/topup",{key:u}),{success:A,message:s,data:r}=C.data;A?(Y("兑换成功！"),fe.success({title:"兑换成功！",content:"成功兑换额度："+me(r),centered:!0}),_(m=>m+r),n("")):f(s)}catch{f("请求失败")}finally{w(!1)}},ee=()=>{if(!h){f("超级管理员未设置充值链接！");return}window.open(h,"_blank")},te=async C=>{if(!E){f("管理员未开启在线充值！");return}if(await x(),o<v){f("充值数量不能小于"+v);return}Z(C),H(!0)},K=async()=>{if(p===0&&await x(),o<v){f("充值数量不能小于"+v);return}H(!1);try{const C=await M.post("/api/user/pay",{amount:parseInt(o),top_up_code:c,payment_method:W});if(C!==void 0){const{message:A,data:s}=C.data;if(A==="success"){let r=s,m=C.data.url,S=document.createElement("form");S.action=m,S.method="POST",navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1||(S.target="_blank");for(let D in r){let B=document.createElement("input");B.type="hidden",B.name=D,B.value=r[D],S.appendChild(B)}document.body.appendChild(S),S.submit(),document.body.removeChild(S)}else f(s)}else f(C)}catch(C){console.log(C)}finally{}},b=async()=>{let C=await M.get("/api/user/self");const{success:A,message:s,data:r}=C.data;A?_(r.quota):f(s)};t.useEffect(()=>{let C=localStorage.getItem("status");C&&(C=JSON.parse(C),C.top_up_link&&l(C.top_up_link),C.min_topup&&F(C.min_topup),C.enable_online_topup&&k(C.enable_online_topup)),b().then()},[]);const g=()=>p+"元",x=async C=>{C===void 0&&(C=o);try{const A=await M.post("/api/user/amount",{amount:parseFloat(C),top_up_code:c});if(A!==void 0){const{message:s,data:r}=A.data;s==="success"?j(parseFloat(r)):(j(0),$e.error({content:"错误："+r,id:"getAmount"}))}else f(A)}catch(A){console.log(A)}finally{}},R=()=>{H(!1)};return e.jsx("div",{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"我的钱包"})}),e.jsxs(ae.Content,{children:[e.jsxs(fe,{title:"确定要充值吗",visible:V,onOk:K,onCancel:R,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("p",{children:["充值数量：",o]}),e.jsxs("p",{children:["实付金额：",g()]}),e.jsx("p",{children:"是否确认充值？"})]}),e.jsx("div",{style:{marginTop:20,display:"flex",justifyContent:"center"},children:e.jsxs(Be,{style:{width:"500px",padding:"20px"},children:[e.jsxs(Ve,{level:3,style:{textAlign:"center"},children:["余额 ",me(z)]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(yu,{children:"兑换余额"}),e.jsxs(I,{children:[e.jsx(I.Input,{field:"redemptionCode",label:"兑换码",placeholder:"兑换码",name:"redemptionCode",value:u,onChange:C=>{n(C)}}),e.jsxs(he,{children:[h?e.jsx(P,{type:"primary",theme:"solid",onClick:ee,children:"获取兑换码"}):null,e.jsx(P,{type:"warning",theme:"solid",onClick:Q,disabled:N,children:N?"兑换中...":"兑换"})]})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(yu,{children:"在线充值"}),e.jsxs(I,{children:[e.jsx(I.Input,{disabled:!E,field:"redemptionCount",label:"实付金额："+g(),placeholder:"充值数量，最低 "+mn(v),name:"redemptionCount",type:"number",value:o,onChange:async C=>{C<1&&(C=1),i(C),await x(C)}}),e.jsxs(he,{children:[e.jsx(P,{type:"primary",theme:"solid",onClick:async()=>{te("zfb")},children:"支付宝"}),e.jsx(P,{style:{backgroundColor:"rgba(var(--semi-green-5), 1)"},type:"primary",theme:"solid",onClick:async()=>{te("wx")},children:"微信"})]})]})]})]})})]})]})})};function Yu(u){return(u===void 0||u==="")&&(u="{}"),JSON.parse(u)}const{Header:hs}=ae,Zu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function Fs(u){switch(u){case 1:return e.jsxs($,{color:"cyan",size:"large",children:[" ","充值"," "]});case 2:return e.jsxs($,{color:"lime",size:"large",children:[" ","消费"," "]});case 3:return e.jsxs($,{color:"orange",size:"large",children:[" ","管理"," "]});case 4:return e.jsxs($,{color:"purple",size:"large",children:[" ","系统"," "]});default:return e.jsxs($,{color:"black",size:"large",children:[" ","未知"," "]})}}function Xu(u){return u?e.jsx($,{color:"blue",size:"large",children:"流"}):e.jsx($,{color:"purple",size:"large",children:"非流"})}function et(u){const n=parseInt(u);return n<101?e.jsxs($,{color:"green",size:"large",children:[" ",n," s"," "]}):n<300?e.jsxs($,{color:"orange",size:"large",children:[" ",n," s"," "]}):e.jsxs($,{color:"red",size:"large",children:[" ",n," s"," "]})}function ps(u){let n=parseFloat(u)/1e3;return n=n.toFixed(1),n<3?e.jsxs($,{color:"green",size:"large",children:[" ",n," s"," "]}):n<10?e.jsxs($,{color:"orange",size:"large",children:[" ",n," s"," "]}):e.jsxs($,{color:"red",size:"large",children:[" ",n," s"," "]})}const ms=()=>{const u=[{title:"时间",dataIndex:"timestamp2string"},{title:"渠道",dataIndex:"channel",className:ke()?"tableShow":"tableHiddle",render:(y,U,ue)=>w?U.type===0||U.type===2?e.jsx("div",{children:e.jsxs($,{color:Zu[parseInt(y)%Zu.length],size:"large",children:[" ",y," "]})}):e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{})},{title:"用户",dataIndex:"username",className:ke()?"tableShow":"tableHiddle",render:(y,U,ue)=>w?e.jsxs("div",{children:[e.jsx(Ou,{size:"small",color:du(y),style:{marginRight:4},onClick:()=>r(U.user_id),children:typeof y=="string"&&y.slice(0,1)}),y]}):e.jsx(e.Fragment,{})},{title:"令牌",dataIndex:"token_name",render:(y,U,ue)=>U.type===0||U.type===2?e.jsx("div",{children:e.jsxs($,{color:"grey",size:"large",onClick:()=>{J(y)},children:[" ",y," "]})}):e.jsx(e.Fragment,{})},{title:"类型",dataIndex:"type",render:(y,U,ue)=>e.jsx("div",{children:Fs(y)})},{title:"模型",dataIndex:"model_name",render:(y,U,ue)=>U.type===0||U.type===2?e.jsx("div",{children:e.jsxs($,{color:du(y),size:"large",onClick:()=>{J(y)},children:[" ",y," "]})}):e.jsx(e.Fragment,{})},{title:"用时/首字",dataIndex:"use_time",render:(y,U,ue)=>{if(U.is_stream){let ie=Yu(U.other);return e.jsx("div",{children:e.jsxs(he,{children:[et(y),ps(ie.frt),Xu(U.is_stream)]})})}else return e.jsx("div",{children:e.jsxs(he,{children:[et(y),Xu(U.is_stream)]})})}},{title:"提示",dataIndex:"prompt_tokens",render:(y,U,ue)=>U.type===0||U.type===2?e.jsx("div",{children:e.jsxs("span",{children:[" ",y," "]})}):e.jsx(e.Fragment,{})},{title:"补全",dataIndex:"completion_tokens",render:(y,U,ue)=>parseInt(y)>0&&(U.type===0||U.type===2)?e.jsx("div",{children:e.jsxs("span",{children:[" ",y," "]})}):e.jsx(e.Fragment,{})},{title:"花费",dataIndex:"quota",render:(y,U,ue)=>U.type===0||U.type===2?e.jsx("div",{children:me(y,6)}):e.jsx(e.Fragment,{})},{title:"重试",dataIndex:"retry",className:ke()?"tableShow":"tableHiddle",render:(y,U,ue)=>{let ie="渠道："+U.channel;if(U.other!==""){let le=JSON.parse(U.other);if(le===null)return e.jsx(e.Fragment,{});le.admin_info!==void 0&&le.admin_info.use_channel!==null&&le.admin_info.use_channel!==void 0&&le.admin_info.use_channel!==""&&(ie=`渠道：${le.admin_info.use_channel.join("->")}`)}return w?e.jsx("div",{children:ie}):e.jsx(e.Fragment,{})}},{title:"详情",dataIndex:"content",render:(y,U,ue)=>{let ie=Yu(U.other);if(ie==null||U.type!==2)return e.jsx(Wu,{ellipsis:{rows:2,showTooltip:{type:"popover",opts:{style:{width:240}}}},style:{maxWidth:240},children:y});let le=gn(U.prompt_tokens,U.completion_tokens,ie.model_ratio,ie.model_price,ie.completion_ratio,ie.group_ratio);return e.jsx(Ie,{content:le,children:e.jsx(Wu,{ellipsis:{rows:2},style:{maxWidth:240},children:y})})}}],[n,c]=t.useState([]),[a,o]=t.useState(!1),[i,p]=t.useState(!1),[j,v]=t.useState(!1),[F,h]=t.useState(1),[l,E]=t.useState(de),[k,z]=t.useState(de);t.useState(""),t.useState(!1);const[_,N]=t.useState(0),w=ke();let V=new Date;const[H,W]=t.useState({username:"",token_name:"",model_name:"",start_timestamp:Te(V.getTime()/1e3-86400),end_timestamp:Te(V.getTime()/1e3+3600),channel:""}),{username:Z,token_name:Q,model_name:ee,start_timestamp:te,end_timestamp:K,channel:b}=H,[g,x]=t.useState({quota:0,token:0}),R=(y,U)=>{W(ue=>({...ue,[U]:y}))},C=async()=>{let y=Date.parse(te)/1e3,U=Date.parse(K)/1e3,ue=await M.get(`/api/log/self/stat?type=${_}&token_name=${Q}&model_name=${ee}&start_timestamp=${y}&end_timestamp=${U}`);const{success:ie,message:le,data:oe}=ue.data;ie?x(oe):f(le)},A=async()=>{let y=Date.parse(te)/1e3,U=Date.parse(K)/1e3,ue=await M.get(`/api/log/stat?type=${_}&username=${Z}&token_name=${Q}&model_name=${ee}&start_timestamp=${y}&end_timestamp=${U}&channel=${b}`);const{success:ie,message:le,data:oe}=ue.data;ie?x(oe):f(le)},s=async()=>{v(!0),w?await A():await C(),o(!0),v(!1)},r=async y=>{if(!w)return;const U=await M.get(`/api/user/${y}`),{success:ue,message:ie,data:le}=U.data;ue?fe.info({title:"用户信息",content:e.jsxs("div",{style:{padding:12},children:[e.jsxs("p",{children:["用户名: ",le.username]}),e.jsxs("p",{children:["余额: ",me(le.quota)]}),e.jsxs("p",{children:["已用额度：",me(le.used_quota)]}),e.jsxs("p",{children:["请求次数：",Bu(le.request_count)]})]}),centered:!0}):f(ie)},m=y=>{for(let U=0;U<y.length;U++)y[U].timestamp2string=Te(y[U].created_at),y[U].key=""+y[U].id;c(y),E(y.length+de)},S=async(y,U,ue=0)=>{p(!0);let ie="",le=Date.parse(te)/1e3,oe=Date.parse(K)/1e3;w?ie=`/api/log/?p=${y}&page_size=${U}&type=${ue}&username=${Z}&token_name=${Q}&model_name=${ee}&start_timestamp=${le}&end_timestamp=${oe}&channel=${b}`:ie=`/api/log/self/?p=${y}&page_size=${U}&type=${ue}&token_name=${Q}&model_name=${ee}&start_timestamp=${le}&end_timestamp=${oe}`;const be=await M.get(ie),{success:Pe,message:ze,data:Le}=be.data;if(Pe)if(y===0)m(Le);else{let tu=[...n];tu.splice(y*U,Le.length,...Le),m(tu)}else f(ze);p(!1)},d=n.slice((F-1)*k,F*k),D=y=>{h(y),y===Math.ceil(n.length/k)+1&&S(y-1,k,_).then(U=>{})},B=async y=>{localStorage.setItem("page-size",y+""),z(y),h(1),S(0,y).then().catch(U=>{f(U)})},L=async()=>{h(1),await S(0,k,_)},J=async y=>{await Re(y)?Y("已复制："+y):fe.error({title:"无法复制到剪贴板，请手动复制",content:y})};return t.useEffect(()=>{const y=parseInt(localStorage.getItem("page-size"))||de;z(y),S(0,y).then().catch(U=>{f(U)})},[]),e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(hs,{children:e.jsx(De,{spinning:j,children:e.jsxs("h3",{children:["使用明细（总消耗额度：",e.jsx("span",{onClick:s,style:{cursor:"pointer",color:"gray"},children:a?me(g.quota):"点击查看"}),"）"]})})}),e.jsx(I,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(I.Input,{field:"token_name",label:"令牌名称",style:{width:176},value:Q,placeholder:"可选值",name:"token_name",onChange:y=>R(y,"token_name")}),e.jsx(I.Input,{field:"model_name",label:"模型名称",style:{width:176},value:ee,placeholder:"可选值",name:"model_name",onChange:y=>R(y,"model_name")}),e.jsx(I.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:te,value:te,type:"dateTime",name:"start_timestamp",onChange:y=>R(y,"start_timestamp")}),e.jsx(I.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:K,value:K,type:"dateTime",name:"end_timestamp",onChange:y=>R(y,"end_timestamp")}),w&&e.jsxs(e.Fragment,{children:[e.jsx(I.Input,{field:"channel",label:"渠道 ID",style:{width:176},value:b,placeholder:"可选值",name:"channel",onChange:y=>R(y,"channel")}),e.jsx(I.Input,{field:"username",label:"用户名称",style:{width:176},value:Z,placeholder:"可选值",name:"username",onChange:y=>R(y,"username")})]}),e.jsx(I.Section,{children:e.jsx(P,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:L,loading:i,children:"查询"})})]})}),e.jsx(Qe,{style:{marginTop:5},columns:u,dataSource:d,pagination:{currentPage:F,pageSize:k,total:l,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,onPageSizeChange:y=>{B(y).then()},onPageChange:D}}),e.jsxs(Me,{defaultValue:"0",style:{width:120},onChange:y=>{N(parseInt(y)),S(0,k,parseInt(y))},children:[e.jsx(Me.Option,{value:"0",children:"全部"}),e.jsx(Me.Option,{value:"1",children:"充值"}),e.jsx(Me.Option,{value:"2",children:"消费"}),e.jsx(Me.Option,{value:"3",children:"管理"}),e.jsx(Me.Option,{value:"4",children:"系统"})]})]})})},gs=()=>e.jsx(e.Fragment,{children:e.jsx(ms,{})}),xs=()=>{const u=localStorage.getItem("chat_link");return e.jsx("iframe",{src:u,style:{width:"100%",height:"85vh",border:"none"}})},ut=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function Es(u){switch(u){case"IMAGINE":return e.jsx($,{color:"blue",size:"large",children:"绘图"});case"UPSCALE":return e.jsx($,{color:"orange",size:"large",children:"放大"});case"VARIATION":return e.jsx($,{color:"purple",size:"large",children:"变换"});case"HIGH_VARIATION":return e.jsx($,{color:"purple",size:"large",children:"强变换"});case"LOW_VARIATION":return e.jsx($,{color:"purple",size:"large",children:"弱变换"});case"PAN":return e.jsx($,{color:"cyan",size:"large",children:"平移"});case"DESCRIBE":return e.jsx($,{color:"yellow",size:"large",children:"图生文"});case"BLEND":return e.jsx($,{color:"lime",size:"large",children:"图混合"});case"SHORTEN":return e.jsx($,{color:"pink",size:"large",children:"缩词"});case"REROLL":return e.jsx($,{color:"indigo",size:"large",children:"重绘"});case"INPAINT":return e.jsx($,{color:"violet",size:"large",children:"局部重绘-提交"});case"ZOOM":return e.jsx($,{color:"teal",size:"large",children:"变焦"});case"CUSTOM_ZOOM":return e.jsx($,{color:"teal",size:"large",children:"自定义变焦-提交"});case"MODAL":return e.jsx($,{color:"green",size:"large",children:"窗口处理"});case"SWAP_FACE":return e.jsx($,{color:"light-green",size:"large",children:"换脸"});default:return e.jsx($,{color:"white",size:"large",children:"未知"})}}function Cs(u){switch(u){case 1:return e.jsx($,{color:"green",size:"large",children:"已提交"});case 21:return e.jsx($,{color:"lime",size:"large",children:"等待中"});case 22:return e.jsx($,{color:"orange",size:"large",children:"重复提交"});case 0:return e.jsx($,{color:"yellow",size:"large",children:"未提交"});default:return e.jsx($,{color:"white",size:"large",children:"未知"})}}function fs(u){switch(u){case"SUCCESS":return e.jsx($,{color:"green",size:"large",children:"成功"});case"NOT_START":return e.jsx($,{color:"grey",size:"large",children:"未启动"});case"SUBMITTED":return e.jsx($,{color:"yellow",size:"large",children:"队列中"});case"IN_PROGRESS":return e.jsx($,{color:"blue",size:"large",children:"执行中"});case"FAILURE":return e.jsx($,{color:"red",size:"large",children:"失败"});case"MODAL":return e.jsx($,{color:"yellow",size:"large",children:"窗口等待"});default:return e.jsx($,{color:"white",size:"large",children:"未知"})}}const js=u=>{const n=new Date(u*1e3),c=n.getFullYear(),a=("0"+(n.getMonth()+1)).slice(-2),o=("0"+n.getDate()).slice(-2),i=("0"+n.getHours()).slice(-2),p=("0"+n.getMinutes()).slice(-2),j=("0"+n.getSeconds()).slice(-2);return`${c}-${a}-${o} ${i}:${p}:${j}`};function ys(u,n){if(!u||!n)return"N/A";const c=new Date(u),i=((new Date(n)-c)/1e3).toFixed(1),p=i>60?"red":"green";return e.jsxs($,{color:p,size:"large",children:[i," 秒"]})}const Ds=()=>{const[u,n]=t.useState(!1),[c,a]=t.useState(""),o=[{title:"提交时间",dataIndex:"submit_time",render:(d,D,B)=>e.jsx("div",{children:js(d/1e3)})},{title:"花费时间",dataIndex:"finish_time",key:"finish_time",render:(d,D)=>ys(D.submit_time,d)},{title:"渠道",dataIndex:"channel_id",className:ke()?"tableShow":"tableHiddle",render:(d,D,B)=>e.jsx("div",{children:e.jsxs($,{color:ut[parseInt(d)%ut.length],size:"large",onClick:()=>{S(d)},children:[" ",d," "]})})},{title:"类型",dataIndex:"action",render:(d,D,B)=>e.jsx("div",{children:Es(d)})},{title:"任务ID",dataIndex:"mj_id",render:(d,D,B)=>e.jsx("div",{children:d})},{title:"提交结果",dataIndex:"code",className:ke()?"tableShow":"tableHiddle",render:(d,D,B)=>e.jsx("div",{children:Cs(d)})},{title:"任务状态",dataIndex:"status",className:ke()?"tableShow":"tableHiddle",render:(d,D,B)=>e.jsx("div",{children:fs(d)})},{title:"进度",dataIndex:"progress",render:(d,D,B)=>e.jsx("div",{children:e.jsx(it,{stroke:D.status==="FAILURE"?"var(--semi-color-warning)":null,percent:d?parseInt(d.replace("%","")):0,showInfo:!0,"aria-label":"drawing progress"})})},{title:"结果图片",dataIndex:"image_url",render:(d,D,B)=>d?e.jsx(P,{onClick:()=>{Z(d),w(!0)},children:"查看图片"}):"无"},{title:"Prompt",dataIndex:"prompt",render:(d,D,B)=>d?e.jsx(X.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{a(d),n(!0)},children:d}):"无"},{title:"PromptEn",dataIndex:"prompt_en",render:(d,D,B)=>d?e.jsx(X.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{a(d),n(!0)},children:d}):"无"},{title:"失败原因",dataIndex:"fail_reason",render:(d,D,B)=>d?e.jsx(X.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{a(d),n(!0)},children:d}):"无"}],[i,p]=t.useState([]),[j,v]=t.useState(!0),[F,h]=t.useState(1),[l,E]=t.useState(de),[k,z]=t.useState(0),_=ke(),[N,w]=t.useState(!1),[V,H]=t.useState(!1),[W,Z]=t.useState("");let Q=new Date;const[ee,te]=t.useState({channel_id:"",mj_id:"",start_timestamp:Te(Q.getTime()/1e3-2592e3),end_timestamp:Te(Q.getTime()/1e3+3600)}),{channel_id:K,mj_id:b,start_timestamp:g,end_timestamp:x}=ee;t.useState({quota:0,token:0});const R=(d,D)=>{te(B=>({...B,[D]:d}))},C=d=>{for(let D=0;D<d.length;D++)d[D].timestamp2string=Te(d[D].created_at),d[D].key=""+d[D].id;p(d),E(d.length+de)},A=async d=>{v(!0);let D="",B=Date.parse(g),L=Date.parse(x);_?D=`/api/mj/?p=${d}&channel_id=${K}&mj_id=${b}&start_timestamp=${B}&end_timestamp=${L}`:D=`/api/mj/self/?p=${d}&mj_id=${b}&start_timestamp=${B}&end_timestamp=${L}`;const J=await M.get(D),{success:y,message:U,data:ue}=J.data;if(y)if(d===0)C(ue);else{let ie=[...i];ie.splice(d*de,ue.length,...ue),C(ie)}else f(U);v(!1)},s=i.slice((F-1)*de,F*de),r=d=>{h(d),d===Math.ceil(i.length/de)+1&&A(d-1).then(D=>{})},m=async()=>{h(1),await A(0)},S=async d=>{await Re(d)?Y("已复制："+d):fe.error({title:"无法复制到剪贴板，请手动复制",content:d})};return t.useEffect(()=>{m().then()},[k]),t.useEffect(()=>{localStorage.getItem("mj_notify_enabled")!=="true"&&H(!0)},[]),e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[_&&V?e.jsx(Ke,{type:"info",description:"当前未开启Midjourney回调，部分项目可能无法获得绘图结果，可在运营设置中开启。"}):e.jsx(e.Fragment,{}),e.jsx(I,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(I.Input,{field:"channel_id",label:"渠道 ID",style:{width:176},value:K,placeholder:"可选值",name:"channel_id",onChange:d=>R(d,"channel_id")}),e.jsx(I.Input,{field:"mj_id",label:"任务 ID",style:{width:176},value:b,placeholder:"可选值",name:"mj_id",onChange:d=>R(d,"mj_id")}),e.jsx(I.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:g,value:g,type:"dateTime",name:"start_timestamp",onChange:d=>R(d,"start_timestamp")}),e.jsx(I.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:x,value:x,type:"dateTime",name:"end_timestamp",onChange:d=>R(d,"end_timestamp")}),e.jsx(I.Section,{children:e.jsx(P,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:m,children:"查询"})})]})}),e.jsx(Qe,{style:{marginTop:5},columns:o,dataSource:s,pagination:{currentPage:F,pageSize:de,total:l,pageSizeOpts:[10,20,50,100],onPageChange:r},loading:j}),e.jsx(fe,{visible:u,onOk:()=>n(!1),onCancel:()=>n(!1),closable:null,bodyStyle:{height:"400px",overflow:"auto"},width:800,children:e.jsx("p",{style:{whiteSpace:"pre-line"},children:c})}),e.jsx(lt,{src:W,visible:N,onVisibleChange:d=>w(d)})]})})},Bs=()=>e.jsx(e.Fragment,{children:e.jsx(Ds,{})});function As(u){switch(u){case 1:return e.jsx($,{color:"teal",size:"large",children:"按次计费"});case 0:return e.jsx($,{color:"violet",size:"large",children:"按量计费"});default:return"未知"}}function bs(u){return u?e.jsx(lu,{content:e.jsx("div",{style:{padding:8},children:"您的分组可以使用该模型"}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx(Tt,{style:{color:"green"},size:"large"})},u):e.jsx(lu,{content:e.jsx("div",{style:{padding:8},children:"您的分组无权使用该模型"}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx(It,{style:{color:"#FFA54F"},size:"large"})},u)}const Ss=()=>{const[u,n]=t.useState([]),c=t.useRef({isComposition:!1}),[a,o]=t.useState([]),[i,p]=t.useState(""),[j,v]=t.useState(!1),F=t.useMemo(()=>({onChange:(b,g)=>{o(b)}}),[]),h=b=>{if(c.current.isComposition)return;n(b?[b]:[])},l=()=>{c.current.isComposition=!0},E=b=>{c.current.isComposition=!1;const g=b.target.value;n(g?[g]:[])},k=[{title:"可用性",dataIndex:"available",render:(b,g,x)=>bs(b),sorter:(b,g)=>b.available-g.available},{title:e.jsxs(he,{children:[e.jsx("span",{children:"模型名称"}),e.jsx(se,{placeholder:"模糊搜索",style:{width:200},onCompositionStart:l,onCompositionEnd:E,onChange:h,showClear:!0})]}),dataIndex:"model_name",render:(b,g,x)=>e.jsx(e.Fragment,{children:e.jsx($,{color:"green",size:"large",onClick:()=>{K(b)},children:b})}),onFilter:(b,g)=>g.model_name.toLowerCase().includes(b.toLowerCase()),filteredValue:u},{title:"计费类型",dataIndex:"quota_type",render:(b,g,x)=>As(parseInt(b)),sorter:(b,g)=>b.quota_type-g.quota_type},{title:()=>e.jsxs("span",{style:{display:"flex",alignItems:"center"},children:["倍率",e.jsx(lu,{content:e.jsxs("div",{style:{padding:8},children:["倍率是为了方便换算不同价格的模型",e.jsx("br",{}),"点击查看倍率说明"]}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx(ot,{onClick:()=>{p("/ratio.png"),v(!0)}})})]}),dataIndex:"model_ratio",render:(b,g,x)=>{let R=b,C=parseFloat(g.completion_ratio.toFixed(3));return R=e.jsxs(e.Fragment,{children:[e.jsxs(uu,{children:["模型：",g.quota_type===0?b:"无"]}),e.jsx("br",{}),e.jsxs(uu,{children:["补全：",g.quota_type===0?C:"无"]})]}),e.jsx("div",{children:R})}},{title:"模型价格",dataIndex:"model_price",render:(b,g,x)=>{let R=b;if(g.quota_type===0){let C=g.model_ratio*2*g.group_ratio,A=g.model_ratio*g.completion_ratio*2*g.group_ratio;R=e.jsxs(e.Fragment,{children:[e.jsxs(uu,{children:["提示 $",C," / 1M tokens"]}),e.jsx("br",{}),e.jsxs(uu,{children:["补全 $",A," / 1M tokens"]})]})}else{let C=parseFloat(b)*g.group_ratio;R=e.jsxs(e.Fragment,{children:["模型价格：$",C]})}return e.jsx("div",{children:R})}}],[z,_]=t.useState([]),[N,w]=t.useState(!0),[V,H]=t.useContext(Ze),[W,Z]=t.useState(1),Q=(b,g)=>{for(let x=0;x<b.length;x++)b[x].key=b[x].model_name,b[x].group_ratio=g;b.sort((x,R)=>x.quota_type-R.quota_type),b.sort((x,R)=>x.model_name.startsWith("gpt")&&!R.model_name.startsWith("gpt")?-1:!x.model_name.startsWith("gpt")&&R.model_name.startsWith("gpt")?1:x.model_name.localeCompare(R.model_name)),_(b)},ee=async()=>{w(!0);let b="";b="/api/pricing";const g=await M.get(b),{success:x,message:R,data:C,group_ratio:A}=g.data;x?(Z(A),Q(C,A)):f(R),w(!1)},te=async()=>{await ee()},K=async b=>{await Re(b)?Y("已复制："+b):fe.error({title:"无法复制到剪贴板，请手动复制",content:b})};return t.useEffect(()=>{te().then()},[]),e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[V.user?e.jsx(Ke,{type:"success",fullMode:!1,closeIcon:"null",description:`您的分组为：${V.user.group}，分组倍率为：${W}`}):e.jsx(Ke,{type:"warning",fullMode:!1,closeIcon:"null",description:`您还未登陆，显示的价格为默认分组倍率: ${W}`}),e.jsx("br",{}),e.jsx(Ke,{type:"info",fullMode:!1,description:e.jsx("div",{children:"按量计费费用 = 分组倍率 × 模型倍率 × （提示token数 + 补全token数 × 补全倍率）/ 500000 （单位：美元）"}),closeIcon:"null"}),e.jsx("br",{}),e.jsx(P,{theme:"light",type:"tertiary",style:{width:150},onClick:()=>{K(a)},disabled:a=="",children:"复制选中模型"}),e.jsx(Qe,{style:{marginTop:5},columns:k,dataSource:z,loading:N,pagination:{pageSize:z.length,showSizeChanger:!1},rowSelection:F}),e.jsx(lt,{src:i,visible:j,onVisibleChange:b=>v(b)})]})})},ws=()=>e.jsx(e.Fragment,{children:e.jsx(Ss,{})}),tt=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"],nt=u=>{const n=new Date(u*1e3),c=n.getFullYear(),a=("0"+(n.getMonth()+1)).slice(-2),o=("0"+n.getDate()).slice(-2),i=("0"+n.getHours()).slice(-2),p=("0"+n.getMinutes()).slice(-2),j=("0"+n.getSeconds()).slice(-2);return`${c}-${a}-${o} ${i}:${p}:${j}`};function vs(u,n){if(!u||!n)return"N/A";const c=new Date(u),i=((new Date(n)-c)/1e3).toFixed(1),p=i>60?"red":"green";return e.jsxs($,{color:p,size:"large",children:[i," 秒"]})}const ks=()=>{const[u,n]=t.useState(!1),[c,a]=t.useState(""),o=ke(),i=[{title:"提交时间",dataIndex:"submit_time",render:(r,m,S)=>e.jsx("div",{children:r?nt(r):"-"})},{title:"结束时间",dataIndex:"finish_time",render:(r,m,S)=>e.jsx("div",{children:r?nt(r):"-"})},{title:"进度",dataIndex:"progress",width:50,render:(r,m,S)=>e.jsx("div",{children:isNaN(r.replace("%",""))?r:e.jsx(it,{width:42,type:"circle",showInfo:!0,percent:Number(r.replace("%","")||0),"aria-label":"drawing progress"})})},{title:"花费时间",dataIndex:"finish_time",key:"finish_time",render:(r,m)=>e.jsx(e.Fragment,{children:r?vs(m.submit_time,r):"-"})},{title:"渠道",dataIndex:"channel_id",className:o?"tableShow":"tableHiddle",render:(r,m,S)=>e.jsx("div",{children:e.jsxs($,{color:tt[parseInt(r)%tt.length],size:"large",onClick:()=>{R(r)},children:[" ",r," "]})})},{title:"平台",dataIndex:"platform",render:(r,m,S)=>e.jsx("div",{children:A(r)})},{title:"类型",dataIndex:"action",render:(r,m,S)=>e.jsx("div",{children:C(r)})},{title:"任务ID（点击查看详情）",dataIndex:"task_id",render:(r,m,S)=>e.jsx(X.Text,{ellipsis:{showTooltip:!0},onClick:()=>{a(JSON.stringify(m,null,2)),n(!0)},children:e.jsx("div",{children:r})})},{title:"任务状态",dataIndex:"status",render:(r,m,S)=>e.jsx("div",{children:s(r)})},{title:"失败原因",dataIndex:"fail_reason",render:(r,m,S)=>r?e.jsx(X.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{a(r),n(!0)},children:r}):"无"}],[p,j]=t.useState([]),[v,F]=t.useState(!0),[h,l]=t.useState(1),[E,k]=t.useState(de),[z]=t.useState(0);let _=new Date,N=new Date(_.getFullYear(),_.getMonth(),_.getDate());const[w,V]=t.useState({channel_id:"",task_id:"",start_timestamp:Te(N.getTime()/1e3),end_timestamp:""}),{channel_id:H,task_id:W,start_timestamp:Z,end_timestamp:Q}=w,ee=(r,m)=>{V(S=>({...S,[m]:r}))},te=r=>{for(let m=0;m<r.length;m++)r[m].timestamp2string=Te(r[m].created_at),r[m].key=""+r[m].id;j(r),k(r.length+de)},K=async r=>{F(!0);let m="",S=parseInt(Date.parse(Z)/1e3),d=parseInt(Date.parse(Q)/1e3);o?m=`/api/task/?p=${r}&channel_id=${H}&task_id=${W}&start_timestamp=${S}&end_timestamp=${d}`:m=`/api/task/self?p=${r}&task_id=${W}&start_timestamp=${S}&end_timestamp=${d}`;const D=await M.get(m);let{success:B,message:L,data:J}=D.data;if(B)if(r===0)te(J);else{let y=[...p];y.splice(r*de,J.length,...J),te(y)}else f(L);F(!1)},b=p.slice((h-1)*de,h*de),g=r=>{l(r),r===Math.ceil(p.length/de)+1&&K(r-1).then(m=>{})},x=async()=>{l(1),await K(0)},R=async r=>{await Re(r)?Y("已复制："+r):fe.error({title:"无法复制到剪贴板，请手动复制",content:r})};t.useEffect(()=>{x().then()},[z]);const C=r=>{switch(r){case"MUSIC":return e.jsx(Se,{basic:!0,color:"grey",children:" 生成音乐 "});case"LYRICS":return e.jsx(Se,{basic:!0,color:"pink",children:" 生成歌词 "});default:return e.jsx(Se,{basic:!0,color:"black",children:" 未知 "})}},A=r=>{switch(r){case"suno":return e.jsx(Se,{basic:!0,color:"green",children:" Suno "});default:return e.jsx(Se,{basic:!0,color:"black",children:" 未知 "})}},s=r=>{switch(r){case"SUCCESS":return e.jsx(Se,{basic:!0,color:"green",children:" 成功 "});case"NOT_START":return e.jsx(Se,{basic:!0,color:"black",children:" 未启动 "});case"SUBMITTED":return e.jsx(Se,{basic:!0,color:"yellow",children:" 队列中 "});case"IN_PROGRESS":return e.jsx(Se,{basic:!0,color:"blue",children:" 执行中 "});case"FAILURE":return e.jsx(Se,{basic:!0,color:"red",children:" 失败 "});case"QUEUED":return e.jsx(Se,{basic:!0,color:"red",children:" 排队中 "});case"UNKNOWN":return e.jsx(Se,{basic:!0,color:"red",children:" 未知 "});case"":return e.jsx(Se,{basic:!0,color:"black",children:" 正在提交 "});default:return e.jsx(Se,{basic:!0,color:"black",children:" 未知 "})}};return e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(I,{layout:"horizontal",labelPosition:"inset",children:e.jsxs(e.Fragment,{children:[o&&e.jsx(I.Input,{field:"channel_id",label:"渠道 ID",style:{width:"236px",marginBottom:"10px"},value:H,placeholder:"可选值",name:"channel_id",onChange:r=>ee(r,"channel_id")}),e.jsx(I.Input,{field:"task_id",label:"任务 ID",style:{width:"236px",marginBottom:"10px"},value:W,placeholder:"可选值",name:"task_id",onChange:r=>ee(r,"task_id")}),e.jsx(I.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:"236px",marginBottom:"10px"},initValue:Z,value:Z,type:"dateTime",name:"start_timestamp",onChange:r=>ee(r,"start_timestamp")}),e.jsx(I.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:"236px",marginBottom:"10px"},initValue:Q,value:Q,type:"dateTime",name:"end_timestamp",onChange:r=>ee(r,"end_timestamp")}),e.jsx(P,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:x,children:"查询"})]})}),e.jsx(Be,{children:e.jsx(Qe,{columns:i,dataSource:b,pagination:{currentPage:h,pageSize:de,total:E,pageSizeOpts:[10,20,50,100],onPageChange:g},loading:v})}),e.jsx(fe,{visible:u,onOk:()=>n(!1),onCancel:()=>n(!1),closable:null,bodyStyle:{height:"400px",overflow:"auto"},width:800,children:e.jsx("p",{style:{whiteSpace:"pre-line"},children:c})})]})})},_s=()=>e.jsx(e.Fragment,{children:e.jsx(ks,{})}),Ts=t.lazy(()=>Uu(()=>import("./index-BZAmtwIl.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Is=t.lazy(()=>Uu(()=>import("./index-BSDsIKGF.js"),__vite__mapDeps([7,1,2,3,8,4,5,6]))),Ps=t.lazy(()=>Uu(()=>import("./index-2v2s2rql.js"),__vite__mapDeps([9,1,2,3,4,5,6])));function $s(){const[u,n]=t.useContext(Ze),c=()=>{let a=localStorage.getItem("user");if(a){let o=JSON.parse(a);n({type:"login",payload:o})}};return t.useEffect(()=>{c();let a=Au();a&&(document.title=a);let o=pu();if(o){let i=document.querySelector("link[rel~='icon']");i&&(i.href=o)}},[]),e.jsx(ae,{children:e.jsx(ae.Content,{children:e.jsxs(Yt,{children:[e.jsx(pe,{path:"/",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Ts,{})})}),e.jsx(pe,{path:"/channel",element:e.jsx(Ue,{children:e.jsx(us,{})})}),e.jsx(pe,{path:"/channel/edit/:id",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Ru,{})})}),e.jsx(pe,{path:"/channel/add",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Ru,{})})}),e.jsx(pe,{path:"/token",element:e.jsx(Ue,{children:e.jsx(as,{})})}),e.jsx(pe,{path:"/redemption",element:e.jsx(Ue,{children:e.jsx(cs,{})})}),e.jsx(pe,{path:"/user",element:e.jsx(Ue,{children:e.jsx(fn,{})})}),e.jsx(pe,{path:"/user/edit/:id",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Mu,{})})}),e.jsx(pe,{path:"/user/edit",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Mu,{})})}),e.jsx(pe,{path:"/user/reset",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Jn,{})})}),e.jsx(pe,{path:"/login",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(vn,{})})}),e.jsx(pe,{path:"/register",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(jn,{})})}),e.jsx(pe,{path:"/reset",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Vn,{})})}),e.jsx(pe,{path:"/oauth/github",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Qn,{})})}),e.jsx(pe,{path:"/setting",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(qn,{})})})}),e.jsx(pe,{path:"/topup",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(ds,{})})})}),e.jsx(pe,{path:"/log",element:e.jsx(Ue,{children:e.jsx(gs,{})})}),e.jsx(pe,{path:"/detail",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Is,{})})})}),e.jsx(pe,{path:"/midjourney",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Bs,{})})})}),e.jsx(pe,{path:"/task",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(_s,{})})})}),e.jsx(pe,{path:"/pricing",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(ws,{})})}),e.jsx(pe,{path:"/about",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Ps,{})})}),e.jsx(pe,{path:"/chat",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(xs,{})})}),e.jsx(pe,{path:"*",element:e.jsx(kn,{})})]})})})}localStorage.getItem("chat_link");const Ms=()=>{const[u,n]=t.useContext(Ze);let c=Oe();const[a,o]=t.useState(!1);Au(),pu();const i=new Date,p=i.getMonth()===0&&i.getDate()===1||i.getMonth()===1&&i.getDate()>=9&&i.getDate()<=24;async function j(){o(!1),await M.get("/api/user/logout"),Y("注销成功!"),n({type:"logout"}),localStorage.removeItem("user"),c("/login")}const v=()=>{wu.init("root",{}),wu.start(),setTimeout(()=>{wu.stop(),setTimeout(()=>{window.location.reload()},1e4)},3e3)},F=jt(),h=_n();return t.useEffect(()=>{F==="dark"&&document.body.setAttribute("theme-mode","dark"),p&&console.log("Happy New Year!")},[]),e.jsx(e.Fragment,{children:e.jsx(ae,{children:e.jsx("div",{style:{width:"100%"},children:e.jsx(eu,{mode:"horizontal",renderWrapper:({itemElement:l,isSubNav:E,isInSubNav:k,props:z})=>{const _={about:"/about",login:"/login",register:"/register"};return e.jsx(ou,{style:{textDecoration:"none"},to:_[z.itemKey],children:l})},selectedKeys:[],onSelect:l=>{},footer:e.jsxs(e.Fragment,{children:[p&&e.jsx(qe,{position:"bottomRight",render:e.jsx(qe.Menu,{children:e.jsx(qe.Item,{onClick:v,children:"Happy New Year!!!"})}),children:e.jsx(eu.Item,{itemKey:"new-year",text:"🏮"})}),e.jsx(eu.Item,{itemKey:"about",icon:e.jsx(ot,{})}),e.jsx(Tu,{checkedText:"🌞",size:"large",checked:F==="dark",uncheckedText:"🌙",onChange:l=>{h(l)}}),u.user?e.jsx(e.Fragment,{children:e.jsxs(qe,{position:"bottomRight",render:e.jsx(qe.Menu,{children:e.jsx(qe.Item,{onClick:j,children:"退出"})}),children:[e.jsx(Ou,{size:"small",color:du(u.user.username),style:{margin:4},children:u.user.username[0]}),e.jsx("span",{children:u.user.username})]})}):e.jsxs(e.Fragment,{children:[e.jsx(eu.Item,{itemKey:"login",text:"登录",icon:e.jsx(ct,{})}),e.jsx(eu.Item,{itemKey:"register",text:"注册",icon:e.jsx(dt,{})})]})]})})})})})};var Rs={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};const Os=()=>{Au();const[u,n]=t.useState(on());let c=5;const a=()=>{let i=localStorage.getItem("footer_html");i&&n(i)},o=e.jsxs("div",{className:"custom-footer",children:[e.jsxs("a",{href:"https://github.com/Calcium-Ion/new-api",target:"_blank",rel:"noreferrer",children:["New API ",Rs.VITE_REACT_APP_VERSION," "]}),"由"," ",e.jsx("a",{href:"https://github.com/Calcium-Ion",target:"_blank",rel:"noreferrer",children:"Calcium-Ion"})," ","开发，基于"," ",e.jsx("a",{href:"https://github.com/songquanpeng/one-api",target:"_blank",rel:"noreferrer",children:"One API"})]});return t.useEffect(()=>{const i=setInterval(()=>{if(c<=0){clearInterval(i);return}c--,a()},200);return()=>clearTimeout(i)},[]),e.jsx(ae,{children:e.jsx(ae.Content,{style:{textAlign:"center"},children:u?e.jsx(Ie,{content:o,children:e.jsx("div",{className:"custom-footer",dangerouslySetInnerHTML:{__html:u}})}):o})})},zs=(u,n)=>{switch(n.type){case"set":return{...u,status:n.payload};case"unset":return{...u,status:void 0};default:return u}},Bt={status:void 0},At=Fu.createContext({state:Bt,dispatch:()=>null}),Ls=({children:u})=>{const[n,c]=Fu.useReducer(zs,Bt);return e.jsx(At.Provider,{value:[n,c],children:u})},Ns=()=>{t.useContext(Ze);const[u,n]=t.useContext(At),c=_e()||localStorage.getItem("default_collapse_sidebar")==="true";Oe();const[a,o]=t.useState(["home"]),i=Au(),p=pu(),[j,v]=t.useState(c),F={home:"/",channel:"/channel",token:"/token",redemption:"/redemption",topup:"/topup",user:"/user",log:"/log",midjourney:"/midjourney",setting:"/setting",about:"/about",chat:"/chat",detail:"/detail",pricing:"/pricing",task:"/task"},h=t.useMemo(()=>[{text:"首页",itemKey:"home",to:"/",icon:e.jsx(Pt,{})},{text:"渠道",itemKey:"channel",to:"/channel",icon:e.jsx($t,{}),className:ke()?"semi-navigation-item-normal":"tableHiddle"},{text:"聊天",itemKey:"chat",to:"/chat",icon:e.jsx(Mt,{}),className:localStorage.getItem("chat_link")?"semi-navigation-item-normal":"tableHiddle"},{text:"令牌",itemKey:"token",to:"/token",icon:e.jsx(ct,{})},{text:"兑换码",itemKey:"redemption",to:"/redemption",icon:e.jsx(Rt,{}),className:ke()?"semi-navigation-item-normal":"tableHiddle"},{text:"钱包",itemKey:"topup",to:"/topup",icon:e.jsx(Ot,{})},{text:"模型价格",itemKey:"pricing",to:"/pricing",icon:e.jsx(zt,{})},{text:"用户管理",itemKey:"user",to:"/user",icon:e.jsx(dt,{}),className:ke()?"semi-navigation-item-normal":"tableHiddle"},{text:"日志",itemKey:"log",to:"/log",icon:e.jsx(Lt,{})},{text:"数据看板",itemKey:"detail",to:"/detail",icon:e.jsx(Nt,{}),className:localStorage.getItem("enable_data_export")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"绘图",itemKey:"midjourney",to:"/midjourney",icon:e.jsx(Ut,{}),className:localStorage.getItem("enable_drawing")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"异步任务",itemKey:"task",to:"/task",icon:e.jsx(Wt,{}),className:localStorage.getItem("enable_task")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"设置",itemKey:"setting",to:"/setting",icon:e.jsx(Kt,{})}],[localStorage.getItem("enable_data_export"),localStorage.getItem("enable_drawing"),localStorage.getItem("enable_task"),localStorage.getItem("chat_link"),ke()]),l=async()=>{const E=await M.get("/api/status");if(E===void 0)return;const{success:k,data:z}=E.data;k?(n({type:"set",payload:z}),Sn(z)):f("无法正常连接至服务器！")};return t.useEffect(()=>{l().then(()=>{v(_e()||localStorage.getItem("default_collapse_sidebar")==="true")});let E=window.location.pathname.split("/")[1];E===""&&(E="home"),o([E])},[]),e.jsx(e.Fragment,{children:e.jsx(ae,{children:e.jsx("div",{style:{height:"100%"},children:e.jsx(eu,{style:{maxWidth:200},defaultIsCollapsed:_e()||localStorage.getItem("default_collapse_sidebar")==="true",isCollapsed:j,onCollapseChange:E=>{v(E)},selectedKeys:a,renderWrapper:({itemElement:E,isSubNav:k,isInSubNav:z,props:_})=>e.jsx(ou,{style:{textDecoration:"none"},to:F[_.itemKey],children:E}),items:h,onSelect:E=>{o([E.itemKey])},header:{logo:e.jsx("img",{src:p,alt:"logo",style:{marginRight:"0.75em"}}),text:i},children:e.jsx(eu.Footer,{collapseButton:!0})})})})})},Us=$u.createRoot(document.getElementById("root")),{Sider:Ws,Content:Ks,Header:Hs}=ae;Us.render(e.jsx(Fu.StrictMode,{children:e.jsx(Ls,{children:e.jsx(Dn,{children:e.jsx(Zt,{children:e.jsx(Tn,{children:e.jsxs(ae,{children:[e.jsx(Ws,{children:e.jsx(Ns,{})}),e.jsxs(ae,{children:[e.jsx(Hs,{children:e.jsx(Ms,{})}),e.jsx(Ks,{style:{padding:"24px"},children:e.jsx($s,{})}),e.jsx(ae.Footer,{children:e.jsx(Os,{})})]}),e.jsx(un,{})]})})})})})}));export{M as A,At as S,f as a,Bu as b,Ys as c,me as d,Xs as g,ke as i,ea as m,Zs as r,Gu as s,Te as t};
